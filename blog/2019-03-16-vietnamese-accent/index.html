<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "\/"
        },
        "articleSection" : "blog",
        "name" : "Thêm dấu tiếng việt cho câu không dấu",
        "headline" : "Thêm dấu tiếng việt cho câu không dấu",
        "description" : "Ở bài viết này, chúng ta sẽ đề cập đến một bài toán hết sức thú vị trong xử lý ngôn ngữ tự nhiên, đó là thêm dấu tiếng việt. Các bạn thử đoán xem câu \x27me noi rang em rat dam dang\x27 khi thêm dấu sẽ ra như thế nào?.",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-03-16 00:12:00 \x2b0300 \x2b0300",
        "dateModified" : "2019-03-16 00:12:00 \x2b0300 \x2b0300",
        "url" : "\/blog\/2019-03-16-vietnamese-accent\/",
        "wordCount" : "1465",
        "keywords" : [ "machine learning","nlp","thêm dấu tiếng việt","Blog" ]
    }
    </script>
        
            
                <title>Thêm dấu tiếng việt cho câu không dấu</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
		<meta name="generator" content="Phạm Duy Tùng" />
        
  
    
  

  

  
  
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta name="msapplication-tooltip" content="Blog ML của Phạm Duy Tùng và Đặng Thị Hằng">
   
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">



        
            <meta name="author" content="Phạm Duy Tùng">
        
        
            <meta name="description" content="Ở bài viết này, chúng ta sẽ đề cập đến một bài toán hết sức thú vị trong xử lý ngôn ngữ tự nhiên, đó là thêm dấu tiếng việt. Các bạn thử đoán xem câu &#39;me noi rang em rat dam dang&#39; khi thêm dấu sẽ ra như thế nào?.">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Thêm dấu tiếng việt cho câu không dấu"/>
<meta name="twitter:description" content="Ở bài viết này, chúng ta sẽ đề cập đến một bài toán hết sức thú vị trong xử lý ngôn ngữ tự nhiên, đó là thêm dấu tiếng việt. Các bạn thử đoán xem câu &#39;me noi rang em rat dam dang&#39; khi thêm dấu sẽ ra như thế nào?."/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Thêm dấu tiếng việt cho câu không dấu" />
<meta property="og:description" content="Ở bài viết này, chúng ta sẽ đề cập đến một bài toán hết sức thú vị trong xử lý ngôn ngữ tự nhiên, đó là thêm dấu tiếng việt. Các bạn thử đoán xem câu &#39;me noi rang em rat dam dang&#39; khi thêm dấu sẽ ra như thế nào?." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2019-03-16-vietnamese-accent/" />
<meta property="article:published_time" content="2019-03-16T00:12:00+03:00" />
<meta property="article:modified_time" content="2019-03-16T00:12:00+03:00" />

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Thêm dấu tiếng việt cho câu không dấu">
<meta itemprop="description" content="Ở bài viết này, chúng ta sẽ đề cập đến một bài toán hết sức thú vị trong xử lý ngôn ngữ tự nhiên, đó là thêm dấu tiếng việt. Các bạn thử đoán xem câu &#39;me noi rang em rat dam dang&#39; khi thêm dấu sẽ ra như thế nào?.">
<meta itemprop="datePublished" content="2019-03-16T00:12:00&#43;03:00" />
<meta itemprop="dateModified" content="2019-03-16T00:12:00&#43;03:00" />
<meta itemprop="wordCount" content="1465">



<meta itemprop="keywords" content="machine learning,nlp,thêm dấu tiếng việt," />
        

        
            
        

        
        
          
			
			 <link rel="stylesheet" href="/css/font-awesome.min.css">
			 <link rel="stylesheet" href="/css/bootstrap.min.css">


          
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.15.8/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-114911596-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

	  
	  <style>
	  
	  body{
font-family: Helvetica,Arial,sans-serif;
}

.card{
	margin-bottom: 10px;
}

#disqus_thread{
padding: 0 5px;
}

.item-header{
padding: 0;
}

.single-content-img{
width: 100%;
    max-height: 450px !important;
    background-size: cover;
    display: block;
    background-position: center;
}

.thumbnail {
    position: relative;
}

.caption {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
	background: rgba(0, 0, 0, 0.25);
	text-align:left;
}

.caption .title{
	font-size: 1.6em;
    line-height: 1.4em;
    top: 0;
	margin-left:20px;
	margin-top:20px;
	
}

.caption .title-caption{
margin-left:10px;
}

#content p{
text-align: justify;
    line-height: 1.9;
    font-size: 12pt;
}

#content img{
	display: block;
    margin-left: auto;
margin-right: auto;
max-width:98%;
}

img + strong {
    font-style: normal;
    display: inherit;
    text-align: center;
}
.img-news{
max-height:150px;
width:100%;
}

.news-tittle{
	padding-top:15px;
	text-align:justify;
}

.author{
	color: orange;
}
.author-inline{
	color: orange;
}

.adv{
height:18px;
}

h1, h2, h3, h4{
padding-bottom: 10px;
    font-weight: bold;
}

h1{
color: #d04764}


h2{
color: orange}

h3{
color: #d04764}

h4{
color: #8dec89}

.hljs{
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;}
	  .titledetail {
    display: block;
    overflow: hidden;
    line-height: 53px;
    font-size: 45px;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;
    margin: auto;
	padding:25px 0;
	text-align:justify;
}

.newsrelate {
    display: block;
    overflow: hidden;
	 list-style:none;
}
a ,a:hover{
    text-decoration: none;
}
.newsrelate li {
    float: left;
    overflow: hidden;
    width: 30%;
    margin-left: 2.5%;
    margin-bottom: 15px;
}

.newsrelate li a {
    display: block;
    overflow: hidden;
}

.newsrelate li h3 {
    display: block;
    overflow: hidden;
    line-height: 1.3em;
    font-size: 16pt;
    color: #333;
    line-height: 22px;
    font-weight: 300;
    font-family: Arial,Helvetica,sans-serif;
    width: auto;
    margin: 5px auto;
}

.titlerelate {
    overflow: hidden;
    font-size: 18px;
    font-weight: 600;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    line-height: 32px;
    text-transform: uppercase;
}


	  </style>
	  
    </head>
    <body>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1546237302193677',
      xfbml      : true,
      version    : 'v5.0'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v5.0&appId=1853483258232756&autoLogAppEvents=1"></script>
      
      

    
    
<header id="header"  style="background: #790014; color: hsla(0,0%,100%,1);">
<div class="container">
    <nav class="navbar navbar-expand-md navbar-dark">
	
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            
                <li class="nav-item">
                    <a class='nav-link' href="/blog">
                            <i class="fa fa-home active">&nbsp;</i>Home
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/news/">
                            <i class="fa fa-list">&nbsp;</i>News
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/xem-truyen/">
                            <i class="fa fa-id-card-o">&nbsp;</i>Truyện
                    </a>
                </li>
            
        </ul>
    </nav>
    </div></div>
</header>


   
    
	<div class="container">
	<div class="adv"></div>
	<div>
    <main role="main" >
	
        
        
        <article class="col-md-10 col-lg-9 mx-auto">
  


        
		 <div class="">
            <h3 class="titledetail">Thêm dấu tiếng việt cho câu không dấu</h3>
			
			<div class="col-md-12">
			 
			  <time class="published"
            datetime='2019-03-16'>
            16/03/2019</time>
		 - 
			   <span class="author">Phạm Duy Tùng</span>
			   
			
		<div class="thumbnail text-center">
		 <img class="img-fluid single-content-img lazy" src="/post_image/nlp.jpg" />
		
			</div>
			 
            
        
       



  

  

  <div id="content" class="col-md-10 mx-auto">
    <p>Thêm dấu tiếng việt là một trong những bài toán khá hay trong xử lý  ngôn ngữ tự nhiên. Ở đây, mình đã tiến hành thu thập dữ liệu bài báo của nhiều nguồn khác nhau như zing.vn, vnexpress, kenh14.vn &hellip; làm kho ngữ liệu và xây dựng mô hình.</p>
<p>Để tiến hành thực nghiệm, mình sẽ lấy một số đoạn văn mẫu ở trang tin tức của thế giới di động (https.www.thegioididong.com) (mình không crawl nội dung tin tức ở trang này làm dữ liệu học).</p>
<p>Ở bài viết link <a href="https://www.thegioididong.com/tin-tuc/3-ngay-cuoi-tuan-mua-laptop-online-tang-them-pmh-den-400k-tra-gop-0--1151334,">https://www.thegioididong.com/tin-tuc/3-ngay-cuoi-tuan-mua-laptop-online-tang-them-pmh-den-400k-tra-gop-0--1151334,</a> mình lấy đoạn mở đầu &ldquo;Từ ngày 15/3 đến 17/3, nhiều mẫu laptop tại Thế Giới Di Động sẽ được ưu đãi mạnh, tặng phiếu mua hàng đến 400 ngàn đồng, trả góp 0% và nhiều quà tặng hấp dẫn khác khi mua theo hình thức ONLINE. Nếu đang có nhu cầu mua laptop, bạn hãy nhanh chóng xem qua danh sách sản phẩm dưới đây nhé.&quot;, bỏ dấu của câu đi, thì mình được câu</p>
<p>&ldquo;Tu ngay 15/3 den 17/3, nhieu mau laptop tai The Gioi Di Dong se duoc uu dai manh, tang phieu mua hang den 400 ngan dong, tra gop 0% va nhieu qua tang hap dan khac khi mua theo hinh thuc ONLINE. Neu dang co nhu cau mua laptop, ban hay nhanh chong xem qua danh sach san pham duoi day nhe.&rdquo;</p>
<p>Sử dụng mô hình mình đã huấn luyện, thu được kết quả như sau:</p>
<p>&ldquo;Từ ngày 15/3 đến 17/3 m t m, nhiều mẫu laptoP tạI thế giỚi di động sẽ được ưu đãi mạnh, tang phiếu mua hàng đến 400 ngàn đồng, trả góp 0 r% và nhiều quà tặng hấp dẫn khác khi mua theo hìNH THỨc Onfine. nếu đang có nhu cầu mua laptop, bạn hãy nhanh chóng xem qua danh sách sản phẩm dưới&rdquo;</p>
<p>Kết quả khá khả quan phải không các bạn, còn một số lỗi nhỏ ở phần nhận dạng ký tự hoa nữa. Mình sẽ fix lại ở các bài viết sau.</p>
<p>Mình thí nghiệm tiếp với phần đầu bài viết <a href="https://www.thegioididong.com/tin-tuc/apple-ban-ra-thi-truong-35-trieu-cap-tai-nghe-airpods-nam-2018-1155181">https://www.thegioididong.com/tin-tuc/apple-ban-ra-thi-truong-35-trieu-cap-tai-nghe-airpods-nam-2018-1155181</a>.
Đoạn &ldquo;Hôm nay, báo cáo của Counterpoint Research cho thấy, trong năm 2018 Apple đã bán được khoảng 35 triệu cặp tai nghe không dây AirPods. Theo hãng phân tích này, AirPods hiện là tai nghe không dây phổ biến nhất.&quot;, bỏ dấu tiếng việt là thu được &ldquo;Hom nay, bao cao cua Counterpoint Research cho thay, trong nam 2018 Apple da ban duoc khoang 35 trieu cap tai nghe khong day AirPods. Theo hang phan tich nay, AirPods hien la tai nghe khong day pho bien nhat.&rdquo;</p>
<p>Kết quả của mô hình: &ldquo;Hôm nay, bạo cáo của Coorteenria eEeeroa c ttt, trong năm 2018 apple đã bán được khoảng 35 triệu cặp tại nghe không đầy aitcoDs. theo Hàng phân tích này, airxoDs Hiện là tai nghe không dạy phổ biến nhất.&rdquo;</p>
<p>Mô hình của mình cho lặp 50 lần. Mình tiến hành thí nghiệm và publish mô hình ở lần lặp thứ 10.</p>
<p>Mã nguồn file predict</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> keras.models <span style="color:#f92672">import</span> load_model
model <span style="color:#f92672">=</span> load_model(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a_best_weight.h5</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> Counter

<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

<span style="color:#f92672">import</span> utils
<span style="color:#f92672">import</span> string
<span style="color:#f92672">import</span> re

alphabet <span style="color:#f92672">=</span> set(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74"> _</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(utils<span style="color:#f92672">.</span>ACCENTED_TO_BASE_CHAR_MAP<span style="color:#f92672">.</span>keys()))

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">alphabet</span><span style="color:#e6db74">&#34;</span>,alphabet)
codec <span style="color:#f92672">=</span> utils<span style="color:#f92672">.</span>CharacterCodec(alphabet, utils<span style="color:#f92672">.</span>MAXLEN)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">guess</span>(ngram):
    text <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(ngram)
    text <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">*</span> (utils<span style="color:#f92672">.</span>MAXLEN <span style="color:#f92672">-</span> len(text))
    <span style="color:#66d9ef">if</span> utils<span style="color:#f92672">.</span>INVERT:
        text <span style="color:#f92672">=</span> text[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
    preds <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict_classes(np<span style="color:#f92672">.</span>array([codec<span style="color:#f92672">.</span>encode(text)]), verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
    rtext <span style="color:#f92672">=</span> codec<span style="color:#f92672">.</span>decode(preds[<span style="color:#ae81ff">0</span>], calc_argmax<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>strip(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>)
    <span style="color:#66d9ef">if</span> len(rtext)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>:
        index <span style="color:#f92672">=</span> rtext<span style="color:#f92672">.</span>find(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>)
        <span style="color:#66d9ef">if</span> index<span style="color:#f92672">&gt;</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
            rtext <span style="color:#f92672">=</span> rtext[:index]
    <span style="color:#66d9ef">return</span> rtext


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_accent</span>(text):
    <span style="color:#75715e"># lowercase the input text as we train the model on lowercase text only</span>
    <span style="color:#75715e"># but we keep the map of uppercase characters to restore cases in output</span>
    is_uppercase_map <span style="color:#f92672">=</span> [c<span style="color:#f92672">.</span>isupper() <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> text]
    text <span style="color:#f92672">=</span> utils<span style="color:#f92672">.</span>remove_accent(text<span style="color:#f92672">.</span>lower())

    outputs <span style="color:#f92672">=</span> []
    words_or_symbols_list <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\</span><span style="color:#e6db74">w[</span><span style="color:#e6db74">\</span><span style="color:#e6db74">w ]*|</span><span style="color:#e6db74">\</span><span style="color:#e6db74">W+</span><span style="color:#e6db74">&#39;</span>, text)

    <span style="color:#75715e"># print(words_or_symbols_list)</span>

    <span style="color:#66d9ef">for</span> words_or_symbols <span style="color:#f92672">in</span> words_or_symbols_list:
        <span style="color:#66d9ef">if</span> utils<span style="color:#f92672">.</span>is_words(words_or_symbols):
            outputs<span style="color:#f92672">.</span>append(_add_accent(words_or_symbols))
        <span style="color:#66d9ef">else</span>:
            outputs<span style="color:#f92672">.</span>append(words_or_symbols)
        <span style="color:#75715e"># print(outputs)</span>
    output_text <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(outputs)

    <span style="color:#75715e"># restore uppercase characters</span>
    output_text <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(c<span style="color:#f92672">.</span>upper() <span style="color:#66d9ef">if</span> is_upper <span style="color:#66d9ef">else</span> c
                            <span style="color:#66d9ef">for</span> c, is_upper <span style="color:#f92672">in</span> zip(output_text, is_uppercase_map))
    <span style="color:#66d9ef">return</span> output_text

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_add_accent</span>(phrase):
    grams <span style="color:#f92672">=</span> list(utils<span style="color:#f92672">.</span>gen_ngram(phrase<span style="color:#f92672">.</span>lower(), n<span style="color:#f92672">=</span>utils<span style="color:#f92672">.</span>NGRAM, pad_words<span style="color:#f92672">=</span>utils<span style="color:#f92672">.</span>PAD_WORDS_INPUT))
    
    guessed_grams <span style="color:#f92672">=</span> list(guess(gram) <span style="color:#66d9ef">for</span> gram <span style="color:#f92672">in</span> grams)
    <span style="color:#75715e"># print(&#34;phrase&#34;,phrase,&#39;grams&#39;,grams,&#39;guessed_grams&#39;,guessed_grams)</span>
    candidates <span style="color:#f92672">=</span> [Counter() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(len(guessed_grams) <span style="color:#f92672">+</span> utils<span style="color:#f92672">.</span>NGRAM <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)]
    <span style="color:#66d9ef">for</span> idx, gram <span style="color:#f92672">in</span> enumerate(guessed_grams):
        <span style="color:#66d9ef">for</span> wid, word <span style="color:#f92672">in</span> enumerate(re<span style="color:#f92672">.</span>split(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> +</span><span style="color:#e6db74">&#39;</span>, gram)):
            candidates[idx <span style="color:#f92672">+</span> wid]<span style="color:#f92672">.</span>update([word])
    output <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(c<span style="color:#f92672">.</span>most_common(<span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> candidates <span style="color:#66d9ef">if</span> c)
    <span style="color:#66d9ef">return</span> output<span style="color:#f92672">.</span>strip(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span>)



<span style="color:#75715e"># print(add_accent(&#39;do,&#39;))</span>
<span style="color:#75715e"># print(add_accent(&#39;7.3 inch,&#39;))</span>
<span style="color:#75715e"># print(add_accent(&#39;Truoc do, tren san khau su kien SDC 2018, giam doc cao cap mang marketing san pham di dong cua Samsung, ong Justin Denison da cam tren tay nguyen mau cua thiet bi nay. Ve co ban, no chang khac gi mot chiec may tinh bang 7.3 inch, duoc cau thanh tu nhieu lop phu khac nhau nhu polyme, lop man chong soc, lop phan cuc voi do mong gan mot nua so voi the he truoc, lop kinh linh hoat va mot tam lung da nang co the bien thanh man hinh. Tat ca se duoc ket dinh bang mot loai keo cuc ben, cho phep chiec may nay co the gap lai hang tram ngan lan ma khong bi hu hong.&#39;))</span>
<span style="color:#75715e"># print(add_accent(&#39;man hinh. Tat ca se duoc ket dinh bang mot loai keo cuc ben, cho phep chiec may nay co the gap lai hang tram ngan lan ma khong bi hu hong.&#39;))</span>
<span style="color:#66d9ef">print</span>(add_accent(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Hom nay, bao cao cua Counterpoint Research cho thay, trong nam 2018 Apple da ban duoc khoang 35 trieu cap tai nghe khong day AirPods. Theo hang phan tich nay, AirPods hien la tai nghe khong day pho bien nhat.</span><span style="color:#e6db74">&#39;</span>))
</code></pre></div><p>Mã nguồn file utils</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> re
<span style="color:#f92672">import</span> string
<span style="color:#f92672">import</span> time
<span style="color:#f92672">from</span> contextlib <span style="color:#f92672">import</span> contextmanager
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np



<span style="color:#75715e"># maximum string length to train and predict</span>
<span style="color:#75715e"># this is set based on our ngram length break down below</span>
MAXLEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>

<span style="color:#75715e"># minimum string length to consider</span>
MINLEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>

<span style="color:#75715e"># how many words per ngram to consider in our model</span>
NGRAM <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>

<span style="color:#75715e"># inverting the input generally help with accuracy</span>
INVERT <span style="color:#f92672">=</span> True

<span style="color:#75715e"># mini batch size</span>
BATCH_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span>

<span style="color:#75715e"># number of phrases set apart from training set to validate our model</span>
VALIDATION_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">100000</span>

<span style="color:#75715e"># using g2.2xl GPU is ~5x faster than a Macbook Pro Core i5 CPU</span>
HAS_GPU <span style="color:#f92672">=</span> True

PAD_WORDS_INPUT  <span style="color:#f92672">=</span> True

<span style="color:#75715e">### Ánh xạ từ không dấu sang có dấu</span>

ACCENTED_CHARS <span style="color:#f92672">=</span> {
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a á à ả ã ạ â ấ ầ ẩ ẫ ậ ă ắ ằ ẳ ẵ ặ</span><span style="color:#e6db74">&#39;</span>,
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">o</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">o ó ò ỏ õ ọ ô ố ồ ổ ỗ ộ ơ ớ ờ ở ỡ ợ</span><span style="color:#e6db74">&#39;</span>,
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">e</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">e é è ẻ ẽ ẹ ê ế ề ể ễ ệ</span><span style="color:#e6db74">&#39;</span>,
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">u ú ù ủ ũ ụ ư ứ ừ ử ữ ự</span><span style="color:#e6db74">&#39;</span>,
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">i</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">i í ì ỉ ĩ ị</span><span style="color:#e6db74">&#39;</span>,
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">y</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">y ý ỳ ỷ ỹ ỵ</span><span style="color:#e6db74">&#39;</span>,
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">d</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">d đ</span><span style="color:#e6db74">&#39;</span>,
}

<span style="color:#75715e">### Ánh xạ từ có dấu sang không dấu</span>
ACCENTED_TO_BASE_CHAR_MAP <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> c, variants <span style="color:#f92672">in</span> ACCENTED_CHARS<span style="color:#f92672">.</span>items():
	<span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> variants<span style="color:#f92672">.</span>split(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span>):
		ACCENTED_TO_BASE_CHAR_MAP[v] <span style="color:#f92672">=</span> c

<span style="color:#75715e"># \x00 ký tự padding</span>

<span style="color:#75715e">### Những ký tự cơ bản, bao gồm ký tự padding, các chữ cái và các chữ số</span>
BASE_ALPHABET <span style="color:#f92672">=</span> set(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74"> _</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits)

<span style="color:#75715e">### Bộ ký tự bao gồm những ký tự cơ bản và những ký tự có dấu</span>
ALPHABET <span style="color:#f92672">=</span> BASE_ALPHABET<span style="color:#f92672">.</span>union(set(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(ACCENTED_TO_BASE_CHAR_MAP<span style="color:#f92672">.</span>keys())))


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_words</span>(text):
	<span style="color:#66d9ef">return</span> re<span style="color:#f92672">.</span>fullmatch(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\</span><span style="color:#e6db74">w[</span><span style="color:#e6db74">\</span><span style="color:#e6db74">w ]*</span><span style="color:#e6db74">&#39;</span>, text)

<span style="color:#75715e"># Hàm bỏ dấu khỏi một câu</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove_accent</span>(text):
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> remove accent from text </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
	<span style="color:#66d9ef">return</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(ACCENTED_TO_BASE_CHAR_MAP<span style="color:#f92672">.</span>get(char, char) <span style="color:#66d9ef">for</span> char <span style="color:#f92672">in</span> text)

<span style="color:#75715e">#hàm thêm padding vào một câu</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pad</span>(phrase, maxlen):
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> right pad given string with </span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74"> to exact </span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">maxlen</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74"> length </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
	<span style="color:#66d9ef">return</span> phrase <span style="color:#f92672">+</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">*</span> (maxlen <span style="color:#f92672">-</span> len(phrase))


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_ngram</span>(words, n<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, pad_words<span style="color:#f92672">=</span>True):
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> gen n-grams from given phrase or list of words </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
	<span style="color:#66d9ef">if</span> isinstance(words, str):
		words <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>split(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\</span><span style="color:#e6db74">s+</span><span style="color:#e6db74">&#39;</span>, words<span style="color:#f92672">.</span>strip())

	<span style="color:#66d9ef">if</span> len(words) <span style="color:#f92672">&lt;</span> n:
		<span style="color:#66d9ef">if</span> pad_words:
			words <span style="color:#f92672">+</span><span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">*</span> (n <span style="color:#f92672">-</span> len(words))
		<span style="color:#66d9ef">yield</span> tuple(words)
	<span style="color:#66d9ef">else</span>:
		<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(words) <span style="color:#f92672">-</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
			<span style="color:#66d9ef">yield</span> tuple(words[i: i <span style="color:#f92672">+</span> n])

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_phrases</span>(text):
	<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> extract phrases, i.e. group of continuous words, from text </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
	<span style="color:#66d9ef">return</span> re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\</span><span style="color:#e6db74">w[</span><span style="color:#e6db74">\</span><span style="color:#e6db74">w ]+</span><span style="color:#e6db74">&#39;</span>, text, re<span style="color:#f92672">.</span>UNICODE)


<span style="color:#a6e22e">@contextmanager</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">timing</span>(label):
	begin <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic()
	<span style="color:#66d9ef">print</span>(label, end<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span>, flush<span style="color:#f92672">=</span>True)
	<span style="color:#66d9ef">try</span>:
		<span style="color:#66d9ef">yield</span>
	<span style="color:#66d9ef">finally</span>:
		duration <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic() <span style="color:#f92672">-</span> begin
	<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">: took {:.2f}s</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(duration))

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CharacterCodec</span>(object):
    <span style="color:#66d9ef">def</span> __init__(self, alphabet, maxlen):
        self<span style="color:#f92672">.</span>alphabet <span style="color:#f92672">=</span> list(sorted(set(alphabet)))
        self<span style="color:#f92672">.</span>index_alphabet <span style="color:#f92672">=</span> dict((c, i) <span style="color:#66d9ef">for</span> i, c <span style="color:#f92672">in</span> enumerate(self<span style="color:#f92672">.</span>alphabet))
        self<span style="color:#f92672">.</span>maxlen <span style="color:#f92672">=</span> maxlen

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encode</span>(self, C, maxlen<span style="color:#f92672">=</span>None):
        maxlen <span style="color:#f92672">=</span> maxlen <span style="color:#66d9ef">if</span> maxlen <span style="color:#66d9ef">else</span> self<span style="color:#f92672">.</span>maxlen
        X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((maxlen, len(self<span style="color:#f92672">.</span>alphabet)))
        <span style="color:#66d9ef">for</span> i, c <span style="color:#f92672">in</span> enumerate(C[:maxlen]):
            X[i, self<span style="color:#f92672">.</span>index_alphabet[c]] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">return</span> X

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">try_encode</span>(self, C, maxlen<span style="color:#f92672">=</span>None):
        <span style="color:#66d9ef">try</span>:
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>encode(C, maxlen)
        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
            <span style="color:#66d9ef">return</span> None

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decode</span>(self, X, calc_argmax<span style="color:#f92672">=</span>True):
        <span style="color:#66d9ef">if</span> calc_argmax:
            X <span style="color:#f92672">=</span> X<span style="color:#f92672">.</span>argmax(axis<span style="color:#f92672">=</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(self<span style="color:#f92672">.</span>alphabet[x] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> X)
</code></pre></div><p>link donwnload mô hình ở lần lặp thứ 10 ở <a href="https://github.com/AlexBlack2202/alexmodel/blob/master/a_best_weight.h5?raw=true">https://github.com/AlexBlack2202/alexmodel/blob/master/a_best_weight.h5?raw=true</a></p>
<p>À, kết quả của câu nói phần mở đầu là &ldquo;mẹ nói rằng em rất đậm đang&rdquo;. Hi hi, may quá.</p>
<p>Cảm ơn các bạn đã theo dõi. Hẹn gặp bạn ở các bài viết tiếp theo.</p>

  </div>
  
			</div>
  <footer class="col-md-10  mx-auto">
  <div >
  <div class="fb-like" data-share="true"  data-width="450"  data-show-faces="true">
</div> </p></div>
    <ul class="stats list-unstyled">
 
    
  <li class="tags">
    <ul class="list-inline">
       
            
            
                <i class="fa fa-tags"></i>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/machine-learning">machine learning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/nlp">nlp</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/th%C3%AAm-d%E1%BA%A5u-ti%E1%BA%BFng-vi%E1%BB%87t">thêm dấu tiếng việt</a></li>
                
            
        
    </ul>
  </li>
  
</ul>

	</div>
  </footer>
  <hr/>
<div class="titlerelate">Bài viết khác</div>
<div class="infinite-container featured-task">
<div class="card-deck card-break infinite-item">



    
        <div class="card">
		<a href="/blog/2019-02-08-randomized-optimization-in-python-v1/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/post_image/global_maximin.jpg" width="100" />
		<div class="card-body">
		<h5 class="card-title">
		Tối ưu hoá ngẫu nhiên - Bài toán người giao hàng
				</h5>
				</div>
				</a>
				</div>
    

    
        <div class="card">
		<a href="/blog/2019-03-25-mask-rcnn-balloon/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/post_image/feature-pyramid-network-model1.jpg" width="100" />
		
		<div class="card-body">
		<h5 class="card-title">
		Tìm hiểu Mask R-CNN và ví dụ phân vùng quả bóng bay sử dụng deep learning
				</h5>
				</div>
				</a>
				</div>
    

</div>
</div>



<div class="fb-comments" data-href="" data-width="" data-numposts="5"></div>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "phamduytung" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>



</article>


		
    </main>
    
	</div>
	</div>
    
	<hr>
  <footer class="footer">
  <div class="container text-center">
    
    <p class="copyright">
      
        &copy; 2019
        
          Phạm Duy Tùng Machine Learning Blog
        
      
     
    </p>
	</div>
  </footer>
    
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/languages/python.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
     

   <script src="/js/jquery-3.3.1.min.js"></script>
   
    <script src="/js/bootstrap.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
     
    

    
      
        
      
    
	
    
    <script>hljs.initHighlightingOnLoad();</script>
      
<script async
src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


	  
	  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114911596-1"  data-cfasync="false"></script>
<script  data-cfasync="false">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114911596-1');
</script>
<script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.5.1/intersection-observer.js"  data-cfasync="false"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.0.0/dist/lazyload.min.js"  data-cfasync="false"></script>
	   <script  type="text/javascript"  data-cfasync="false">

  function getcontent(){
 

   

             var myLazyLoad = new LazyLoad({
    elements_selector: ".lazy"
});
                }
            
			
			$(document).ready(function(){
			getcontent();
			}); 
</script>

  </body>
</html>

