<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "\/"
        },
        "articleSection" : "blog",
        "name" : "Phân loại hoa sử dụng pretrain model",
        "headline" : "Phân loại hoa sử dụng pretrain model",
        "description" : "Ở bài viết này, chúng ta sẽ sử dụng pretrain model của kares để phân loại hoa hồng (rose), hoa mặt trời (sunflower), hoa bồ công anh (dandelion), hoa cúc (daisy) và hoa tulip.",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-04-15 00:19:00 \x2b0300 \x2b0300",
        "dateModified" : "2019-04-15 00:19:00 \x2b0300 \x2b0300",
        "url" : "\/blog\/2019-04-15-phan-loai-hoa\/",
        "wordCount" : "2506",
        "keywords" : [ "Machine learning","Deeplearning","hoa hồng","hoa mặt trời","hoa bồ công anh","hoa cúc","hoa tulip","Blog" ]
    }
    </script>
        
            
                <title>Phân loại hoa sử dụng pretrain model</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
		<meta name="generator" content="Phạm Duy Tùng" />
        
  
    
  

  

  
  
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta name="msapplication-tooltip" content="Blog ML của Phạm Duy Tùng và Đặng Thị Hằng">
   
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">



        
            <meta name="author" content="Phạm Duy Tùng">
        
        
            <meta name="description" content="Ở bài viết này, chúng ta sẽ sử dụng pretrain model của kares để phân loại hoa hồng (rose), hoa mặt trời (sunflower), hoa bồ công anh (dandelion), hoa cúc (daisy) và hoa tulip.">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Phân loại hoa sử dụng pretrain model"/>
<meta name="twitter:description" content="Ở bài viết này, chúng ta sẽ sử dụng pretrain model của kares để phân loại hoa hồng (rose), hoa mặt trời (sunflower), hoa bồ công anh (dandelion), hoa cúc (daisy) và hoa tulip."/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Phân loại hoa sử dụng pretrain model" />
<meta property="og:description" content="Ở bài viết này, chúng ta sẽ sử dụng pretrain model của kares để phân loại hoa hồng (rose), hoa mặt trời (sunflower), hoa bồ công anh (dandelion), hoa cúc (daisy) và hoa tulip." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2019-04-15-phan-loai-hoa/" />
<meta property="article:published_time" content="2019-04-15T00:19:00+03:00" />
<meta property="article:modified_time" content="2019-04-15T00:19:00+03:00" />

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Phân loại hoa sử dụng pretrain model">
<meta itemprop="description" content="Ở bài viết này, chúng ta sẽ sử dụng pretrain model của kares để phân loại hoa hồng (rose), hoa mặt trời (sunflower), hoa bồ công anh (dandelion), hoa cúc (daisy) và hoa tulip.">
<meta itemprop="datePublished" content="2019-04-15T00:19:00&#43;03:00" />
<meta itemprop="dateModified" content="2019-04-15T00:19:00&#43;03:00" />
<meta itemprop="wordCount" content="2506">



<meta itemprop="keywords" content="Machine learning,Deeplearning,hoa hồng,hoa mặt trời,hoa bồ công anh,hoa cúc,hoa tulip," />
        

        
            
        

        
        
          
			
			 <link rel="stylesheet" href="/css/font-awesome.min.css">
			 <link rel="stylesheet" href="/css/bootstrap.min.css">


          
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.15.8/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-114911596-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

	  
	  <style>
	  
	  body{
font-family: Helvetica,Arial,sans-serif;
}

.card{
	margin-bottom: 10px;
}

#disqus_thread{
padding: 0 5px;
}

.item-header{
padding: 0;
}

.single-content-img{
width: 100%;
    max-height: 450px !important;
    background-size: cover;
    display: block;
    background-position: center;
}

.thumbnail {
    position: relative;
}

.caption {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
	background: rgba(0, 0, 0, 0.25);
	text-align:left;
}

.caption .title{
	font-size: 1.6em;
    line-height: 1.4em;
    top: 0;
	margin-left:20px;
	margin-top:20px;
	
}

.caption .title-caption{
margin-left:10px;
}

#content p{
text-align: justify;
    line-height: 1.9;
    font-size: 12pt;
}

#content img{
	display: block;
    margin-left: auto;
margin-right: auto;
max-width:98%;
}

img + strong {
    font-style: normal;
    display: inherit;
    text-align: center;
}
.img-news{
max-height:150px;
width:100%;
}

.news-tittle{
	padding-top:15px;
	text-align:justify;
}

.author{
	color: orange;
}
.author-inline{
	color: orange;
}

.adv{
height:18px;
}

h1, h2, h3, h4{
padding-bottom: 10px;
    font-weight: bold;
}

h1{
color: #d04764}


h2{
color: orange}

h3{
color: #d04764}

h4{
color: #8dec89}

.hljs{
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;}
	  .titledetail {
    display: block;
    overflow: hidden;
    line-height: 53px;
    font-size: 45px;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;
    margin: auto;
	padding:25px 0;
	text-align:justify;
}

.newsrelate {
    display: block;
    overflow: hidden;
	 list-style:none;
}
a ,a:hover{
    text-decoration: none;
}
.newsrelate li {
    float: left;
    overflow: hidden;
    width: 30%;
    margin-left: 2.5%;
    margin-bottom: 15px;
}

.newsrelate li a {
    display: block;
    overflow: hidden;
}

.newsrelate li h3 {
    display: block;
    overflow: hidden;
    line-height: 1.3em;
    font-size: 16pt;
    color: #333;
    line-height: 22px;
    font-weight: 300;
    font-family: Arial,Helvetica,sans-serif;
    width: auto;
    margin: 5px auto;
}

.titlerelate {
    overflow: hidden;
    font-size: 18px;
    font-weight: 600;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    line-height: 32px;
    text-transform: uppercase;
}


	  </style>
	  
    </head>
    <body>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1546237302193677',
      xfbml      : true,
      version    : 'v5.0'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v5.0&appId=1853483258232756&autoLogAppEvents=1"></script>
      
      

    
    
<header id="header"  style="background: #790014; color: hsla(0,0%,100%,1);">
<div class="container">
    <nav class="navbar navbar-expand-md navbar-dark">
	
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            
                <li class="nav-item">
                    <a class='nav-link' href="/blog">
                            <i class="fa fa-home active">&nbsp;</i>Home
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/news/">
                            <i class="fa fa-list">&nbsp;</i>News
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/xem-truyen/">
                            <i class="fa fa-id-card-o">&nbsp;</i>Truyện
                    </a>
                </li>
            
        </ul>
    </nav>
    </div></div>
</header>


   
    
	<div class="container">
	<div class="adv"></div>
	<div>
    <main role="main" >
	
        
        
        <article class="col-md-10 col-lg-9 mx-auto">
  


        
		 <div class="">
            <h3 class="titledetail">Phân loại hoa sử dụng pretrain model</h3>
			
			<div class="col-md-12">
			 
			  <time class="published"
            datetime='2019-04-15'>
            15/04/2019</time>
		 - 
			   <span class="author">Phạm Duy Tùng</span>
			   
			
		<div class="thumbnail text-center">
		 <img class="img-fluid single-content-img lazy" src="/post_image/flower-classifition.jpg" />
		
			</div>
			 
            
        
       



  

  

  <div id="content" class="col-md-10 mx-auto">
    <h2 id="lời-mở-đầu">Lời mở đầu</h2>
<p>Ở trong bài viết này, chúng ta sẽ sử dụng tập dữ liệu là tập dữ liệu ở ở link <a href="https://www.kaggle.com/alxmamaev/flowers-recognition">https://www.kaggle.com/alxmamaev/flowers-recognition</a>. Tập dữ liệu này bao gồm 4242 hình cảnh của 5 loại  hoa hồng (rose), hoa mặt trời (sunflower), hoa bồ công anh (dandelion), hoa cúc (daisy) và hoa tulip. Nhóm tác giả đã thu thập dữ liệu dựa trên các trang web  flicr, google images, yandex. Tập hình ảnh được chia thành 5 lớp, mỗi lớp có khoảng 800 hình, có kích thước xấp xỉ 320x320 pixel. Các hình ảnh có kích thước không đồng nhất với nhau.</p>
<h2 id="thực-hiện">Thực hiện</h2>
<p>Dữ liệu sau khi giản nén có dạng</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data_dir<span style="color:#f92672">/</span>classname1<span style="color:#f92672">/</span><span style="color:#f92672">*</span><span style="color:#f92672">.</span><span style="color:#f92672">*</span>
data_dir<span style="color:#f92672">/</span>classname2<span style="color:#f92672">/</span><span style="color:#f92672">*</span><span style="color:#f92672">.</span><span style="color:#f92672">*</span>
<span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
</code></pre></div><p>Cấu trúc lưu trũ như này đúng với mô hình của mình nên chúng ta cần nên chúng ta không thay đổi gì về câu trúc nữa, tiến hành viết code</p>
<p>Đầu tiên, chúng ta sẽ load dataset lên và tranform nó để đưa vào huấn luyện.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> os
<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> defaultdict
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> scipy.misc


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">preprocess_input</span>(x0):
    x <span style="color:#f92672">=</span> x0 <span style="color:#f92672">/</span> <span style="color:#ae81ff">255.</span>
    x <span style="color:#f92672">-</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
    x <span style="color:#f92672">*</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2.</span>
    <span style="color:#66d9ef">return</span> x


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reverse_preprocess_input</span>(x0):
    x <span style="color:#f92672">=</span> x0 <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.0</span>
    x <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
    x <span style="color:#f92672">*</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">255.</span>
    <span style="color:#66d9ef">return</span> x


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dataset</span>(base_dir, n):
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">base dir: </span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>base_dir)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">n: </span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>str(n))
    n <span style="color:#f92672">=</span> int(n)
    d <span style="color:#f92672">=</span> defaultdict(list)
    <span style="color:#66d9ef">for</span> root, subdirs, files <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>walk(base_dir):
        <span style="color:#66d9ef">for</span> filename <span style="color:#f92672">in</span> files:
            file_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(root, filename)
            <span style="color:#66d9ef">assert</span> file_path<span style="color:#f92672">.</span>startswith(base_dir)
            
            suffix <span style="color:#f92672">=</span> file_path[len(base_dir):]
            
            suffix <span style="color:#f92672">=</span> suffix<span style="color:#f92672">.</span>lstrip(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/</span><span style="color:#e6db74">&#34;</span>)
            suffix <span style="color:#f92672">=</span> suffix<span style="color:#f92672">.</span>lstrip(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;</span>)
            <span style="color:#66d9ef">if</span>(suffix<span style="color:#f92672">.</span>find(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">/</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">&gt;</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>): <span style="color:#75715e">#linux</span>
                label <span style="color:#f92672">=</span> suffix<span style="color:#f92672">.</span>split(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/</span><span style="color:#e6db74">&#34;</span>)[<span style="color:#ae81ff">0</span>]
            <span style="color:#66d9ef">else</span>: <span style="color:#75715e">#window</span>
                label <span style="color:#f92672">=</span> suffix<span style="color:#f92672">.</span>split(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;</span>)[<span style="color:#ae81ff">0</span>]
            d[label]<span style="color:#f92672">.</span>append(file_path)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">walk directory complete</span><span style="color:#e6db74">&#34;</span>)
    tags <span style="color:#f92672">=</span> sorted(d<span style="color:#f92672">.</span>keys())

    processed_image_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    useful_image_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    X <span style="color:#f92672">=</span> []
    y <span style="color:#f92672">=</span> []

    <span style="color:#66d9ef">for</span> class_index, class_name <span style="color:#f92672">in</span> enumerate(tags):
        filenames <span style="color:#f92672">=</span> d[class_name]
        <span style="color:#66d9ef">for</span> filename <span style="color:#f92672">in</span> filenames:
            processed_image_count <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
            <span style="color:#66d9ef">if</span> processed_image_count<span style="color:#f92672">%</span><span style="color:#ae81ff">100</span> <span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>:
                <span style="color:#66d9ef">print</span>(class_name<span style="color:#f92672">+</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">process: </span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>str(processed_image_count)<span style="color:#f92672">+</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>str(len(d[class_name])))
            img <span style="color:#f92672">=</span> scipy<span style="color:#f92672">.</span>misc<span style="color:#f92672">.</span>imread(filename)
            height, width, chan <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>shape
            <span style="color:#66d9ef">assert</span> chan <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>
            aspect_ratio <span style="color:#f92672">=</span> float(max((height, width))) <span style="color:#f92672">/</span> min((height, width))
            <span style="color:#66d9ef">if</span> aspect_ratio <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>:
                <span style="color:#66d9ef">continue</span>
            <span style="color:#75715e"># We pick the largest center square.</span>
            centery <span style="color:#f92672">=</span> height <span style="color:#f92672">/</span><span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
            centerx <span style="color:#f92672">=</span> width <span style="color:#f92672">/</span><span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
            radius <span style="color:#f92672">=</span> min((centerx, centery))
            img <span style="color:#f92672">=</span> img[centery<span style="color:#f92672">-</span>radius:centery<span style="color:#f92672">+</span>radius, centerx<span style="color:#f92672">-</span>radius:centerx<span style="color:#f92672">+</span>radius]
            img <span style="color:#f92672">=</span> scipy<span style="color:#f92672">.</span>misc<span style="color:#f92672">.</span>imresize(img, size<span style="color:#f92672">=</span>(n, n), interp<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">bilinear</span><span style="color:#e6db74">&#39;</span>)
            X<span style="color:#f92672">.</span>append(img)
            y<span style="color:#f92672">.</span>append(class_index)
            useful_image_count <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">processed </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">, used </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (processed_image_count, useful_image_count))

    X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(X)<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>float32)
    <span style="color:#75715e">#X = X.transpose((0, 3, 1, 2))</span>
    X <span style="color:#f92672">=</span> preprocess_input(X)
    y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(y)

    perm <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>permutation(len(y))
    X <span style="color:#f92672">=</span> X[perm]
    y <span style="color:#f92672">=</span> y[perm]

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">classes:</span><span style="color:#e6db74">&#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#66d9ef">for</span> class_index, class_name <span style="color:#f92672">in</span> enumerate(tags):
        <span style="color:#66d9ef">print</span>(class_name, sum(y<span style="color:#f92672">==</span>class_index),end<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X shape: </span><span style="color:#e6db74">&#34;</span>,X<span style="color:#f92672">.</span>shape)

    <span style="color:#66d9ef">return</span> X, y, tags
</code></pre></div><p>Đoạn code trên khá đơn giản và dễ hiểu. Lưu ý ở đây là với những bức ảnh có tỷ lệ width và height &gt; 2 thì mình sẽ loại chúng ra khỏi tập dữ liệu.</p>
<p>Tiếp theo, chúng ta sẽ xây dựng mô hình dựa trên mô hình Resnet50 có sẵn của kares, do sử dụng pretrain model, nên n-1 lớp trước đó sẽ không được huấn luyện và chúng ta sẽ sử dụng dụng các weight có sẵn đã được huấn luyện trên tập ImageNet rút đặc trưng cho mô hình. Chúng ta chỉ cần thêm một lớp full connected và softmax để phân lớp các loại hoa, công việc của chúng ta hiện tại là tìm ra trọng số của lớp full connected cuối cùng (thay vì huấn luyện lại hết toàn bộ mô hình).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#75715e"># create the base pre-trained model</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build_model</span>(nb_classes):
    base_model <span style="color:#f92672">=</span> ResNet50(weights<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">imagenet</span><span style="color:#e6db74">&#39;</span>, include_top<span style="color:#f92672">=</span>False)

    <span style="color:#75715e"># add a global spatial average pooling layer</span>
    x <span style="color:#f92672">=</span> base_model<span style="color:#f92672">.</span>output
    x <span style="color:#f92672">=</span> GlobalAveragePooling2D()(x)
    <span style="color:#75715e"># let&#39;s add a fully-connected layer</span>
    x <span style="color:#f92672">=</span> Dense(<span style="color:#ae81ff">1024</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">relu</span><span style="color:#e6db74">&#39;</span>)(x)
    <span style="color:#75715e"># and a logistic layer</span>
    predictions <span style="color:#f92672">=</span> Dense(nb_classes, activation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">softmax</span><span style="color:#e6db74">&#39;</span>)(x)

    <span style="color:#75715e"># this is the model we will train</span>
    model <span style="color:#f92672">=</span> Model(inputs<span style="color:#f92672">=</span>base_model<span style="color:#f92672">.</span>input, outputs<span style="color:#f92672">=</span>predictions)

    <span style="color:#75715e"># first: train only the top layers (which were randomly initialized)</span>
    <span style="color:#75715e"># i.e. freeze all convolutional ResNet50 layers</span>
    <span style="color:#66d9ef">for</span> layer <span style="color:#f92672">in</span> base_model<span style="color:#f92672">.</span>layers:
        layer<span style="color:#f92672">.</span>trainable <span style="color:#f92672">=</span> False

    <span style="color:#66d9ef">return</span> model
	
</code></pre></div><p>Visualize một chút xíu về kiến trúc inceptionV3 mình đang dùng.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param <span style="color:#75715e">#     Connected to</span>
<span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span>
input_1 (InputLayer)            (None, None, None, <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">0</span>
__________________________________________________________________________________________________
conv1_pad (ZeroPadding2D)       (None, None, None, <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">0</span>           input_1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
conv1 (Conv2D)                  (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">9472</span>        conv1_pad[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn_conv1 (BatchNormalization)   (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">256</span>         conv1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_1 (Activation)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           bn_conv1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
pool1_pad (ZeroPadding2D)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           activation_1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
max_pooling2d_1 (MaxPooling2D)  (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           pool1_pad[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2a_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">4160</span>        max_pooling2d_1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2a_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">256</span>         res2a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_2 (Activation)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           bn2a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2a_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">36928</span>       activation_2[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2a_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">256</span>         res2a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_3 (Activation)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           bn2a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2a_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">16640</span>       activation_3[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2a_branch1 (Conv2D)          (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">16640</span>       max_pooling2d_1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2a_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res2a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2a_branch1 (BatchNormalizatio (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res2a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_1 (Add)                     (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn2a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 bn2a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_4 (Activation)       (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           add_1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2b_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">16448</span>       activation_4[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2b_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">256</span>         res2b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_5 (Activation)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           bn2b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2b_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">36928</span>       activation_5[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2b_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">256</span>         res2b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_6 (Activation)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           bn2b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2b_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">16640</span>       activation_6[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2b_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res2b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_2 (Add)                     (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn2b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_4[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_7 (Activation)       (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           add_2[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2c_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">16448</span>       activation_7[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2c_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">256</span>         res2c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_8 (Activation)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           bn2c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2c_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">36928</span>       activation_8[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2c_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">256</span>         res2c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_9 (Activation)       (None, None, None, <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>           bn2c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res2c_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">16640</span>       activation_9[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn2c_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res2c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_3 (Add)                     (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn2c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_7[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_10 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           add_3[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3a_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">32896</span>       activation_10[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3a_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_11 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3a_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">147584</span>      activation_11[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3a_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_12 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3a_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">66048</span>       activation_12[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3a_branch1 (Conv2D)          (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">131584</span>      activation_10[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3a_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res3a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3a_branch1 (BatchNormalizatio (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res3a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_4 (Add)                     (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn3a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 bn3a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_13 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           add_4[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3b_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">65664</span>       activation_13[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3b_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_14 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3b_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">147584</span>      activation_14[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3b_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_15 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3b_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">66048</span>       activation_15[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3b_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res3b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_5 (Add)                     (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn3b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_13[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_16 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           add_5[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3c_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">65664</span>       activation_16[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3c_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_17 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3c_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">147584</span>      activation_17[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3c_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_18 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3c_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">66048</span>       activation_18[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3c_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res3c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_6 (Add)                     (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn3c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_16[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_19 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           add_6[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3d_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">65664</span>       activation_19[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3d_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3d_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_20 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3d_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3d_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">147584</span>      activation_20[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3d_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">512</span>         res3d_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_21 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn3d_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res3d_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">66048</span>       activation_21[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn3d_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res3d_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_7 (Add)                     (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn3d_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_19[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_22 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           add_7[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4a_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">131328</span>      activation_22[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4a_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_23 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4a_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">590080</span>      activation_23[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4a_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_24 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4a_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">263168</span>      activation_24[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4a_branch1 (Conv2D)          (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">525312</span>      activation_22[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4a_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4096</span>        res4a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4a_branch1 (BatchNormalizatio (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4096</span>        res4a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_8 (Add)                     (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn4a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 bn4a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_25 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           add_8[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4b_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">262400</span>      activation_25[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4b_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_26 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4b_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">590080</span>      activation_26[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4b_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_27 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4b_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">263168</span>      activation_27[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4b_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4096</span>        res4b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_9 (Add)                     (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn4b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_25[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_28 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           add_9[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4c_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">262400</span>      activation_28[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4c_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_29 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4c_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">590080</span>      activation_29[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4c_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_30 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4c_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">263168</span>      activation_30[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4c_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4096</span>        res4c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_10 (Add)                    (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn4c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_28[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_31 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           add_10[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4d_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">262400</span>      activation_31[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4d_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4d_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_32 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4d_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4d_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">590080</span>      activation_32[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4d_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4d_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_33 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4d_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4d_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">263168</span>      activation_33[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4d_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4096</span>        res4d_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_11 (Add)                    (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn4d_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_31[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_34 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           add_11[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4e_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">262400</span>      activation_34[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4e_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4e_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_35 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4e_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4e_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">590080</span>      activation_35[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4e_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4e_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_36 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4e_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4e_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">263168</span>      activation_36[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4e_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4096</span>        res4e_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_12 (Add)                    (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn4e_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_34[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_37 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           add_12[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4f_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">262400</span>      activation_37[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4f_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4f_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_38 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4f_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4f_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">590080</span>      activation_38[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4f_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1024</span>        res4f_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_39 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn4f_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res4f_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">263168</span>      activation_39[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn4f_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">4096</span>        res4f_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_13 (Add)                    (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           bn4f_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_37[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_40 (Activation)      (None, None, None, <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>           add_13[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5a_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">524800</span>      activation_40[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5a_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res5a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_41 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn5a_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5a_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2359808</span>     activation_41[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5a_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res5a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_42 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn5a_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5a_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1050624</span>     activation_42[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5a_branch1 (Conv2D)          (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2099200</span>     activation_40[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5a_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">8192</span>        res5a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5a_branch1 (BatchNormalizatio (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">8192</span>        res5a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_14 (Add)                    (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn5a_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 bn5a_branch1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_43 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           add_14[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5b_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">1049088</span>     activation_43[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5b_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res5b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_44 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn5b_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5b_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2359808</span>     activation_44[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5b_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res5b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_45 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn5b_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5b_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1050624</span>     activation_45[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5b_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">8192</span>        res5b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_15 (Add)                    (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn5b_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_43[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_46 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           add_15[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5c_branch2a (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">1049088</span>     activation_46[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5c_branch2a (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res5c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_47 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn5c_branch2a[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5c_branch2b (Conv2D)         (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2359808</span>     activation_47[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5c_branch2b (BatchNormalizati (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">2048</span>        res5c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_48 (Activation)      (None, None, None, <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>           bn5c_branch2b[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
res5c_branch2c (Conv2D)         (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">1050624</span>     activation_48[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
bn5c_branch2c (BatchNormalizati (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">8192</span>        res5c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
add_16 (Add)                    (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           bn5c_branch2c[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
                                                                 activation_46[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
activation_49 (Activation)      (None, None, None, <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>           add_16[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
global_average_pooling2d_1 (Glo (None, <span style="color:#ae81ff">2048</span>)         <span style="color:#ae81ff">0</span>           activation_49[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
dense_1 (Dense)                 (None, <span style="color:#ae81ff">1024</span>)         <span style="color:#ae81ff">2098176</span>     global_average_pooling2d_1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
__________________________________________________________________________________________________
dense_2 (Dense)                 (None, <span style="color:#ae81ff">5</span>)            <span style="color:#ae81ff">5125</span>        dense_1[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
<span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span><span style="color:#f92672">==</span>
Total params: <span style="color:#ae81ff">25</span>,<span style="color:#ae81ff">691</span>,<span style="color:#ae81ff">013</span>
Trainable params: <span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">103</span>,<span style="color:#ae81ff">301</span>
Non<span style="color:#f92672">-</span>trainable params: <span style="color:#ae81ff">23</span>,<span style="color:#ae81ff">587</span>,<span style="color:#ae81ff">712</span>
__________________________________________________________________________________________________
</code></pre></div><p>Phần train lại sẽ có khoảng hơn 2 triệu tham số, phần layer ở trước đó không train là khoảng 23 triệu tham số.</p>
<p>Chia tập dữ liệu ra thành 5 phần, 4 phần làm tập train, 1 phần làm tập validation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">X, y, tags <span style="color:#f92672">=</span> dataset<span style="color:#f92672">.</span>dataset(data_directory, n)
nb_classes <span style="color:#f92672">=</span> len(tags)


sample_count <span style="color:#f92672">=</span> len(y)
train_size <span style="color:#f92672">=</span> sample_count <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">/</span><span style="color:#f92672">/</span> <span style="color:#ae81ff">5</span>
X_train <span style="color:#f92672">=</span> X[:train_size]
y_train <span style="color:#f92672">=</span> y[:train_size]
Y_train <span style="color:#f92672">=</span> np_utils<span style="color:#f92672">.</span>to_categorical(y_train, nb_classes)
X_test  <span style="color:#f92672">=</span> X[train_size:]
y_test  <span style="color:#f92672">=</span> y[train_size:]
Y_test <span style="color:#f92672">=</span> np_utils<span style="color:#f92672">.</span>to_categorical(y_test, nb_classes)
</code></pre></div><p>chúng ta tiến hành thực hiện ImageDataGenerator để có được nhiều dữ liệu mẫu hơn và chống overfit, trong keras đã có sẵn hàm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">datagen <span style="color:#f92672">=</span> ImageDataGenerator(
        featurewise_center<span style="color:#f92672">=</span>False,
        samplewise_center<span style="color:#f92672">=</span>False,
        featurewise_std_normalization<span style="color:#f92672">=</span>False,
        samplewise_std_normalization<span style="color:#f92672">=</span>False,
        zca_whitening<span style="color:#f92672">=</span>False,
        rotation_range<span style="color:#f92672">=</span><span style="color:#ae81ff">45</span>,
        width_shift_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>,
        height_shift_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>,
        horizontal_flip<span style="color:#f92672">=</span>True,
        vertical_flip<span style="color:#f92672">=</span>False,
        channel_shift_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,
        zoom_range<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1.5</span>],
        brightness_range<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1.5</span>],
        fill_mode<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">reflect</span><span style="color:#e6db74">&#39;</span>)
		
datagen<span style="color:#f92672">.</span>fit(X_train)
</code></pre></div><p>Cuối cùng, chúng ta sẽ xây dựng mô hình và tiến hành huấn luyện, lưu mô hình. Quá trình này tốn hơi nhiều thời gian.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
model <span style="color:#f92672">=</span> net<span style="color:#f92672">.</span>build_model(nb_classes)
model<span style="color:#f92672">.</span>compile(optimizer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">rmsprop</span><span style="color:#e6db74">&#39;</span>, loss<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">categorical_crossentropy</span><span style="color:#e6db74">&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">accuracy</span><span style="color:#e6db74">&#34;</span>])

<span style="color:#75715e"># train the model on the new data for a few epochs</span>

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">training the newly added dense layers</span><span style="color:#e6db74">&#34;</span>)

samples_per_epoch <span style="color:#f92672">=</span> X_train<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">/</span><span style="color:#f92672">/</span>batch_size<span style="color:#f92672">*</span>batch_size
steps_per_epoch <span style="color:#f92672">=</span> samples_per_epoch<span style="color:#f92672">/</span><span style="color:#f92672">/</span>batch_size
validation_steps <span style="color:#f92672">=</span> X_test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">/</span><span style="color:#f92672">/</span>batch_size<span style="color:#f92672">*</span>batch_size

model<span style="color:#f92672">.</span>fit_generator(datagen<span style="color:#f92672">.</span>flow(X_train, Y_train, batch_size<span style="color:#f92672">=</span>batch_size, shuffle<span style="color:#f92672">=</span>True),
            samples_per_epoch<span style="color:#f92672">=</span>samples_per_epoch,
            epochs<span style="color:#f92672">=</span>nb_epoch,
            steps_per_epoch <span style="color:#f92672">=</span> steps_per_epoch,
            validation_data<span style="color:#f92672">=</span>datagen<span style="color:#f92672">.</span>flow(X_test, Y_test, batch_size<span style="color:#f92672">=</span>batch_size),
            validation_steps<span style="color:#f92672">=</span>validation_steps,
            )


net<span style="color:#f92672">.</span>save(model, tags, model_file_prefix)
</code></pre></div><p>Thử download một vài hình ảnh trên mạng về rồi test thử xem sao</p>
<p>![Hình ảnh] (../post_image/flower-classifition_demo.jpg)</p>
<p>Kết quả khá tốt phải không các bạn.</p>
<p>Cảm ơn các bạn đã theo dõi. Hẹn gặp bạn ở các bài viết tiếp theo.</p>

  </div>
  
			</div>
  <footer class="col-md-10  mx-auto">
  <div >
  <div class="fb-like" data-share="true"  data-width="450"  data-show-faces="true">
</div> </p></div>
    <ul class="stats list-unstyled">
 
    
  <li class="tags">
    <ul class="list-inline">
       
            
            
                <i class="fa fa-tags"></i>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/machine-learning">Machine learning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/deeplearning">Deeplearning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/hoa-h%E1%BB%93ng">hoa hồng</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/hoa-m%E1%BA%B7t-tr%E1%BB%9Di">hoa mặt trời</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/hoa-b%E1%BB%93-c%C3%B4ng-anh">hoa bồ công anh</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/hoa-c%C3%BAc">hoa cúc</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/hoa-tulip">hoa tulip</a></li>
                
            
        
    </ul>
  </li>
  
</ul>

	</div>
  </footer>
  <hr/>
<div class="titlerelate">Bài viết khác</div>
<div class="infinite-container featured-task">
<div class="card-deck card-break infinite-item">



    
        <div class="card">
		<a href="/blog/2019-04-17-walmart-store-sales-forecasting/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/post_image/walmart.jpg" width="100" />
		<div class="card-body">
		<h5 class="card-title">
		Dự đoán doanh số bán của các cửa hàng walmart
				</h5>
				</div>
				</a>
				</div>
    

    
        <div class="card">
		<a href="/blog/2019-04-19-deep-learning-view/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/post_image/machine-learning-branch.jpg" width="100" />
		
		<div class="card-body">
		<h5 class="card-title">
		Phân nhóm các thuật toán học máy
				</h5>
				</div>
				</a>
				</div>
    

</div>
</div>



<div class="fb-comments" data-href="" data-width="" data-numposts="5"></div>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "phamduytung" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>



</article>


		
    </main>
    
	</div>
	</div>
    
	<hr>
  <footer class="footer">
  <div class="container text-center">
    
    <p class="copyright">
      
        &copy; 2020
        
          Phạm Duy Tùng Machine Learning Blog
        
      
     
    </p>
	</div>
  </footer>
    
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/languages/python.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
     

   <script src="/js/jquery-3.3.1.min.js"></script>
   
    <script src="/js/bootstrap.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
     
    

    
      
        
      
    
	
    
    <script>hljs.initHighlightingOnLoad();</script>
      
<script async
src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


	  
	  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114911596-1"  data-cfasync="false"></script>
<script  data-cfasync="false">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114911596-1');
</script>
<script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.5.1/intersection-observer.js"  data-cfasync="false"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.0.0/dist/lazyload.min.js"  data-cfasync="false"></script>
	   <script  type="text/javascript"  data-cfasync="false">

  function getcontent(){
 

   

             var myLazyLoad = new LazyLoad({
    elements_selector: ".lazy"
});
                }
            
			
			$(document).ready(function(){
			getcontent();
			}); 
</script>

  </body>
</html>

