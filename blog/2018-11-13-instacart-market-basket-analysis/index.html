<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "\/"
        },
        "articleSection" : "blog",
        "name" : "Phân tích giỏ hàng của website instacart",
        "headline" : "Phân tích giỏ hàng của website instacart",
        "description" : "Ở bài viết này, chúng ta sẽ phân tích các item trong giỏ hàng của các đơn hàng trên instacart.",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-11-13 00:19:00 \x2b0300 \x2b0300",
        "dateModified" : "2018-11-13 00:19:00 \x2b0300 \x2b0300",
        "url" : "\/blog\/2018-11-13-instacart-market-basket-analysis\/",
        "wordCount" : "2042",
        "keywords" : [ "Machine learning","Deeplearning","instacart","Giỏ hàng","Đơn hàng","Blog" ]
    }
    </script>
        
            
                <title>Phân tích giỏ hàng của website instacart</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
		<meta name="generator" content="Phạm Duy Tùng" />
        
  
    
  

  

  
  
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta name="msapplication-tooltip" content="Blog ML của Phạm Duy Tùng và Đặng Thị Hằng">
   
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">



        
            <meta name="author" content="Phạm Duy Tùng">
        
        
            <meta name="description" content="Ở bài viết này, chúng ta sẽ phân tích các item trong giỏ hàng của các đơn hàng trên instacart.">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Phân tích giỏ hàng của website instacart"/>
<meta name="twitter:description" content="Ở bài viết này, chúng ta sẽ phân tích các item trong giỏ hàng của các đơn hàng trên instacart."/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Phân tích giỏ hàng của website instacart" />
<meta property="og:description" content="Ở bài viết này, chúng ta sẽ phân tích các item trong giỏ hàng của các đơn hàng trên instacart." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2018-11-13-instacart-market-basket-analysis/" />
<meta property="article:published_time" content="2018-11-13T00:19:00+03:00" />
<meta property="article:modified_time" content="2018-11-13T00:19:00+03:00" />

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Phân tích giỏ hàng của website instacart">
<meta itemprop="description" content="Ở bài viết này, chúng ta sẽ phân tích các item trong giỏ hàng của các đơn hàng trên instacart.">
<meta itemprop="datePublished" content="2018-11-13T00:19:00&#43;03:00" />
<meta itemprop="dateModified" content="2018-11-13T00:19:00&#43;03:00" />
<meta itemprop="wordCount" content="2042">



<meta itemprop="keywords" content="Machine learning,Deeplearning,instacart,Giỏ hàng,Đơn hàng," />
        

        
            
        

        
        
          
			
			 <link rel="stylesheet" href="/css/font-awesome.min.css">
			 <link rel="stylesheet" href="/css/bootstrap.min.css">


          
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.15.8/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-114911596-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

	  
	  <style>
	  
	  body{
font-family: Helvetica,Arial,sans-serif;
}

.card{
	margin-bottom: 10px;
}

#disqus_thread{
padding: 0 5px;
}

.item-header{
padding: 0;
}

.single-content-img{
width: 100%;
    max-height: 450px !important;
    background-size: cover;
    display: block;
    background-position: center;
}

.thumbnail {
    position: relative;
}

.caption {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
	background: rgba(0, 0, 0, 0.25);
	text-align:left;
}

.caption .title{
	font-size: 1.6em;
    line-height: 1.4em;
    top: 0;
	margin-left:20px;
	margin-top:20px;
	
}

.caption .title-caption{
margin-left:10px;
}

#content p{
text-align: justify;
    line-height: 1.9;
    font-size: 12pt;
}

#content img{
	display: block;
    margin-left: auto;
margin-right: auto;
max-width:98%;
}

img + strong {
    font-style: normal;
    display: inherit;
    text-align: center;
}
.img-news{
max-height:150px;
width:100%;
}

.news-tittle{
	padding-top:15px;
	text-align:justify;
}

.author{
	color: orange;
}
.author-inline{
	color: orange;
}

.adv{
height:18px;
}

h1, h2, h3, h4{
padding-bottom: 10px;
    font-weight: bold;
}

h1{
color: #d04764}


h2{
color: orange}

h3{
color: #d04764}

h4{
color: #8dec89}

.hljs{
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;}
	  .titledetail {
    display: block;
    overflow: hidden;
    line-height: 53px;
    font-size: 45px;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;
    margin: auto;
	padding:25px 0;
	text-align:justify;
}

.newsrelate {
    display: block;
    overflow: hidden;
	 list-style:none;
}
a ,a:hover{
    text-decoration: none;
}
.newsrelate li {
    float: left;
    overflow: hidden;
    width: 30%;
    margin-left: 2.5%;
    margin-bottom: 15px;
}

.newsrelate li a {
    display: block;
    overflow: hidden;
}

.newsrelate li h3 {
    display: block;
    overflow: hidden;
    line-height: 1.3em;
    font-size: 16pt;
    color: #333;
    line-height: 22px;
    font-weight: 300;
    font-family: Arial,Helvetica,sans-serif;
    width: auto;
    margin: 5px auto;
}

.titlerelate {
    overflow: hidden;
    font-size: 18px;
    font-weight: 600;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    line-height: 32px;
    text-transform: uppercase;
}


	  </style>
	  
    </head>
    <body>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1546237302193677',
      xfbml      : true,
      version    : 'v5.0'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v5.0&appId=1853483258232756&autoLogAppEvents=1"></script>
      
      

    
    
<header id="header"  style="background: #790014; color: hsla(0,0%,100%,1);">
<div class="container">
    <nav class="navbar navbar-expand-md navbar-dark">
	
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            
                <li class="nav-item">
                    <a class='nav-link' href="/blog">
                            <i class="fa fa-home active">&nbsp;</i>Home
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/news/">
                            <i class="fa fa-list">&nbsp;</i>News
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/xem-truyen/">
                            <i class="fa fa-id-card-o">&nbsp;</i>Truyện
                    </a>
                </li>
            
        </ul>
    </nav>
    </div></div>
</header>


   
    
	<div class="container">
	<div class="adv"></div>
	<div>
    <main role="main" >
	
        
        
        <article class="col-md-10 col-lg-9 mx-auto">
  


        
		 <div class="">
            <h3 class="titledetail">Phân tích giỏ hàng của website instacart</h3>
			
			<div class="col-md-12">
			 
			  <time class="published"
            datetime='2018-11-13'>
            13/11/2018</time>
		 - 
			   <span class="author">Phạm Duy Tùng</span>
			   
			
		<div class="thumbnail text-center">
		 <img class="img-fluid single-content-img lazy" src="http://tradecircle.com.vn/wp-content/uploads/2018/10/instacart.jpg" />
		
			</div>
			 
            
        
       



  

  

  <div id="content" class="col-md-10 mx-auto">
    <h1 id="lời-mở-đầu">Lời mở đầu</h1>
<p>Instacart là một startup cung ứng đồ tạp hóa qua website và ứng dụng di động. Người dùng chỉ cần chọn đồ muốn mua tại các chuỗi bán lẻ và đặt đồ, Instacart sẽ đi mua và giao đến tận tay họ. Đến nay, Instacart hoạt động tại 15.000 cửa hàng tạp hoá tại 4.000 thành phố với khoảng 50.000 “trợ lý mua sắm”. Team data science của instacart đóng vai trò rất quan trọng trong việc cung cấp trải nghiệm người dùng trong việc sử dụng app để mua hàng. Hiện tại, họ đang sử dụng các dữ liệu của khách hàng để tạo nên mô hình dự đoán sản phẩm nào người dùng sẽ mua lại, sẽ mua thử lần đầu tiên, hoặc sẽ thêm vào giỏ hàng. Hiện họ đã publish khoảng 3 triệu đơn hàng của họ để các nhà khoa học dữ liệu khác sử dụng và nghiên cứu.</p>
<h1 id="dẫn-nhập">Dẫn nhập</h1>
<h2 id="phân-tích-dữ-liệu">Phân tích dữ liệu</h2>
<p>Các bạn có thể download dữ liệu ở <a href="https://www.instacart.com/datasets/grocery-shopping-2017">https://www.instacart.com/datasets/grocery-shopping-2017</a>.</p>
<p>Các file bao gồm:</p>
<p>File aisles.csv (134 dòng) có 2 cột là aisle_id,aisle</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">aisle_id,aisle  
<span style="color:#ae81ff">1</span>,prepared soups salads  
<span style="color:#ae81ff">2</span>,specialty cheeses  
<span style="color:#ae81ff">3</span>,energy granola bars  
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
</code></pre></div><p>File departments.csv (21 dòng) gồm 2 cột là department_id,department</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">department_id,department  
<span style="color:#ae81ff">1</span>,frozen  
<span style="color:#ae81ff">2</span>,other  
<span style="color:#ae81ff">3</span>,bakery   
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
</code></pre></div><p>File order_products__(prior|train).csv (trên 30 triệu dòng)</p>
<p>Tập này chứa danh sách sản phẩm được mua trong mỗi đơn hàng. File order_products__prior.csv chứa sản phẩm của đơn hàng trước đó của khách hàng. &lsquo;reordered&rsquo; nói rằng sản phẩm này trong đơn hàng hiện tại đã được mua ở đơn hàng trước đó. Vì vậy, sẽ có đơn hàng không được gán là &lsquo;reordered&rsquo; (chúng ta có thể gán nhãn là None hoặc cái gì đó cũng được để chỉ các sản phẩm này). &lsquo;add_to_cart_order&rsquo; là thứ tự của sp được thêm vào giỏ hàng.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">order_id,product_id,add_to_cart_order,reordered  
 <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">49302</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>  
 <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">11109</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">1</span>  
 <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">10246</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">0</span>  
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span> 
</code></pre></div><p>File orders.csv (3.4 triệu dòng, 206k users): chứa thông tin của đơn hàng, trong đó, order_dow là ngày trong tuần, eval_set thuộc một trong 3 loại là prior, train, test.  order_number là thứ tự của đơn hàng của user này.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">order_id,user_id,eval_set,order_number,order_dow,order_hour_of_day,days_since_prior_order  
 <span style="color:#ae81ff">2539329</span>,<span style="color:#ae81ff">1</span>,prior,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">08</span>,  
 <span style="color:#ae81ff">2398795</span>,<span style="color:#ae81ff">1</span>,prior,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">07</span>,<span style="color:#ae81ff">15.0</span>  
 <span style="color:#ae81ff">473747</span>,<span style="color:#ae81ff">1</span>,prior,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">21.0</span>  
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
</code></pre></div><p>File products.csv ((50k dòng) chứa thông tin sản phẩm:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> product_id,product_name,aisle_id,department_id
 <span style="color:#ae81ff">1</span>,Chocolate Sandwich Cookies,<span style="color:#ae81ff">61</span>,<span style="color:#ae81ff">19</span>  
 <span style="color:#ae81ff">2</span>,All<span style="color:#f92672">-</span>Seasons Salt,<span style="color:#ae81ff">104</span>,<span style="color:#ae81ff">13</span>  
 <span style="color:#ae81ff">3</span>,Robust Golden Unsweetened Oolong Tea,<span style="color:#ae81ff">94</span>,<span style="color:#ae81ff">7</span>  
 <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
</code></pre></div><p>Với mỗi order_id trong tập test ở file orders.csv, chúng ta phải dự đoán các sản phẩm nào người dùng sẽ mua lại (&ldquo;reorder&rdquo;) thuộc đơn hàng đó. Nếu bạn dự đoán đó là đơn hàng không có sản phẩm nào được mua lại, thì ta sẽ điền vào giá trị &lsquo;None&rsquo;</p>
<p>Ví dụ về kết quả dự đoán:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">order_id,products  
<span style="color:#ae81ff">17</span>,<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>  
<span style="color:#ae81ff">34</span>,None  
<span style="color:#ae81ff">137</span>,<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span>  
</code></pre></div><h1 id="thực-hành">Thực hành</h1>
<p>Đầu tiên, ta sẽ import một số thư viện cơ bản để sử dụng, và load tất cả các file lên. Lưu ý một chút là ở đây, mình để tất cả các file trong thư mục data</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> OrderedDict

<span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LogisticRegression
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> f1_score

<span style="color:#f92672">from</span> sklearn <span style="color:#f92672">import</span> metrics, cross_validation
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> f1_score
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> MinMaxScaler

<span style="color:#75715e">#Import the files</span>
aisles_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">data/aisles.csv</span><span style="color:#e6db74">&#39;</span>)
products_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">data/products.csv</span><span style="color:#e6db74">&#39;</span>)
orders_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">data/orders.csv</span><span style="color:#e6db74">&#39;</span>)
order_products_prior_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">data/order_products__prior.csv</span><span style="color:#e6db74">&#39;</span>)
departments_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">data/departments.csv</span><span style="color:#e6db74">&#39;</span>)
order_products_train_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">data/order_products__train.csv</span><span style="color:#e6db74">&#39;</span>)

</code></pre></div><p>Sau đó, mình sẽ merge đơn hàng vào chi tiết đơn hàng của tập train và tập prior</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">order_products_train_df <span style="color:#f92672">=</span> order_products_train_df<span style="color:#f92672">.</span>merge(orders_df<span style="color:#f92672">.</span>drop(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">eval_set</span><span style="color:#e6db74">&#39;</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>), on<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_id</span><span style="color:#e6db74">&#39;</span>)
order_products_prior_df <span style="color:#f92672">=</span> order_products_prior_df<span style="color:#f92672">.</span>merge(orders_df<span style="color:#f92672">.</span>drop(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">eval_set</span><span style="color:#e6db74">&#39;</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>), on<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_id</span><span style="color:#e6db74">&#39;</span>)
</code></pre></div><p>show ra 5 dòng đầu tiên của order_products_train_df</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(order_products_train_df<span style="color:#f92672">.</span>head())

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">   order_id  product_id  add_to_cart_order  reordered  user_id  order_number  order_dow  order_hour_of_day  days_since_prior_order
<span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">49302</span>                  <span style="color:#ae81ff">1</span>          <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">112108</span>             <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">4</span>                 <span style="color:#ae81ff">10</span>                     <span style="color:#ae81ff">9.0</span>
<span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">11109</span>                  <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">112108</span>             <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">4</span>                 <span style="color:#ae81ff">10</span>                     <span style="color:#ae81ff">9.0</span>
<span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">10246</span>                  <span style="color:#ae81ff">3</span>          <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">112108</span>             <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">4</span>                 <span style="color:#ae81ff">10</span>                     <span style="color:#ae81ff">9.0</span>
<span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">49683</span>                  <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">112108</span>             <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">4</span>                 <span style="color:#ae81ff">10</span>                     <span style="color:#ae81ff">9.0</span>
<span style="color:#ae81ff">4</span>         <span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">43633</span>                  <span style="color:#ae81ff">5</span>          <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">112108</span>             <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">4</span>                 <span style="color:#ae81ff">10</span>                     <span style="color:#ae81ff">9.0</span>

[<span style="color:#ae81ff">5</span> rows x <span style="color:#ae81ff">9</span> columns]
</code></pre></div><p>Tổng cộng mình có 9 cột, ý nghĩa các cột mình có giải thích ở trên rồi nha.</p>
<p>Tiếp theo, chúng ta tạo tập tập dữ liệu đếm số lượng sản phẩm của từng người mua</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">user_product_df <span style="color:#f92672">=</span> (order_products_prior_df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>],as_index<span style="color:#f92672">=</span>False) 
                                          <span style="color:#f92672">.</span>agg({<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_id</span><span style="color:#e6db74">&#39;</span>:<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">count</span><span style="color:#e6db74">&#39;</span>}) 
                                          <span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_id</span><span style="color:#e6db74">&#39;</span>:<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_total_orders</span><span style="color:#e6db74">&#39;</span>}))

train_ids <span style="color:#f92672">=</span> order_products_train_df[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>unique() 
df_X <span style="color:#f92672">=</span> user_product_df[user_product_df[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>isin(train_ids)]
<span style="color:#66d9ef">print</span>(df_X<span style="color:#f92672">.</span>head())

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">   product_id  user_id  user_product_total_orders
<span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">138</span>                          <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">1</span>           <span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">709</span>                          <span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">3</span>           <span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">777</span>                          <span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">6</span>           <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">1052</span>                          <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">9</span>           <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">1494</span>                          <span style="color:#ae81ff">3</span>
</code></pre></div><p>Ở đây, người 138 mua sản phẩm 1 2 lần, người 709 mua sản phẩm 1 1 lần, &hellip; tương tự như vậy cho các user và product khác.</p>
<p>Bước tiếp theo, chúng ta sẽ liệt kê các sản phẩm người dùng đã mua:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">train_carts <span style="color:#f92672">=</span> (order_products_train_df<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>,as_index<span style="color:#f92672">=</span>False)
                                      <span style="color:#f92672">.</span>agg({<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>:(<span style="color:#66d9ef">lambda</span> x: set(x))})
                                      <span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>:<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">latest_cart</span><span style="color:#e6db74">&#39;</span>}))
</code></pre></div><p>print(train_carts.head())</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">  user_id                                        latest_cart
<span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">1</span>  {<span style="color:#ae81ff">196</span>, <span style="color:#ae81ff">26405</span>, <span style="color:#ae81ff">27845</span>, <span style="color:#ae81ff">46149</span>, <span style="color:#ae81ff">13032</span>, <span style="color:#ae81ff">39657</span>, <span style="color:#ae81ff">26088.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
<span style="color:#ae81ff">1</span>        <span style="color:#ae81ff">2</span>  {<span style="color:#ae81ff">24838</span>, <span style="color:#ae81ff">11913</span>, <span style="color:#ae81ff">45066</span>, <span style="color:#ae81ff">31883</span>, <span style="color:#ae81ff">48523</span>, <span style="color:#ae81ff">38547</span>, <span style="color:#ae81ff">248.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
<span style="color:#ae81ff">2</span>        <span style="color:#ae81ff">5</span>  {<span style="color:#ae81ff">40706</span>, <span style="color:#ae81ff">21413</span>, <span style="color:#ae81ff">20843</span>, <span style="color:#ae81ff">48204</span>, <span style="color:#ae81ff">21616</span>, <span style="color:#ae81ff">19057</span>, <span style="color:#ae81ff">201.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
<span style="color:#ae81ff">3</span>        <span style="color:#ae81ff">7</span>  {<span style="color:#ae81ff">17638</span>, <span style="color:#ae81ff">29894</span>, <span style="color:#ae81ff">47272</span>, <span style="color:#ae81ff">45066</span>, <span style="color:#ae81ff">13198</span>, <span style="color:#ae81ff">37999</span>, <span style="color:#ae81ff">408.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
<span style="color:#ae81ff">4</span>        <span style="color:#ae81ff">8</span>  {<span style="color:#ae81ff">27104</span>, <span style="color:#ae81ff">15937</span>, <span style="color:#ae81ff">5539</span>, <span style="color:#ae81ff">41540</span>, <span style="color:#ae81ff">31717</span>, <span style="color:#ae81ff">48230</span>, <span style="color:#ae81ff">2224.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
</code></pre></div><p>Mối tương quan giữa sản phẩm được add to card và sản phẩm được mua</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(train_carts, on<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>)
df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> (df_X<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> row: row[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">in</span> row[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">latest_cart</span><span style="color:#e6db74">&#39;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>astype(int))

<span style="color:#66d9ef">print</span>(df_X<span style="color:#f92672">.</span>head())

<span style="color:#66d9ef">print</span>(df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>value_counts())

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># df_X.head()</span>
   product_id  user_id  user_product_total_orders latest_cart  in_cart
<span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">138</span>                          <span style="color:#ae81ff">2</span>     {<span style="color:#ae81ff">42475</span>}        <span style="color:#ae81ff">0</span>
<span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">907</span>      <span style="color:#ae81ff">138</span>                          <span style="color:#ae81ff">2</span>     {<span style="color:#ae81ff">42475</span>}        <span style="color:#ae81ff">0</span>
<span style="color:#ae81ff">2</span>        <span style="color:#ae81ff">1000</span>      <span style="color:#ae81ff">138</span>                          <span style="color:#ae81ff">1</span>     {<span style="color:#ae81ff">42475</span>}        <span style="color:#ae81ff">0</span>
<span style="color:#ae81ff">3</span>        <span style="color:#ae81ff">3265</span>      <span style="color:#ae81ff">138</span>                          <span style="color:#ae81ff">1</span>     {<span style="color:#ae81ff">42475</span>}        <span style="color:#ae81ff">0</span>
<span style="color:#ae81ff">4</span>        <span style="color:#ae81ff">4913</span>      <span style="color:#ae81ff">138</span>                          <span style="color:#ae81ff">1</span>     {<span style="color:#ae81ff">42475</span>}        <span style="color:#ae81ff">0</span>

<span style="color:#75715e"># df_X[&#39;in_cart&#39;].value_counts()</span>
<span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">7645837</span>
<span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">828824</span>
Name: in_cart, dtype: int64
</code></pre></div><p>Tỷ lệ khoảng 9.7%. Điều này nói lên rằng, người dùng trong 1 phiên mua hàng có thể add rất nhiều sản phẩm vào giỏ, nhưng chỉ khoảng 10% sản phẩm họ mua thật sự, hơn 90% sản phẩm còn lại sẽ bị remove trước khi nọ nhấn nút thanh toán.</p>
<h1 id="xây-dựng-tập-đặc-trưng">Xây dựng tập đặc trưng</h1>
<h2 id="đặc-trưng-sản-phẩm">Đặc trưng sản phẩm</h2>
<p>Với đặc trưng sản phẩm, chúng ta sẽ rút trích 2 đặc trưng đơn giản là tổng số lượng đơn hàng của một sản phẩm và trung bình số lượng đơn hàng có chứa sản phẩm.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">prod_features <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_total_orders</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_add_to_cart_order</span><span style="color:#e6db74">&#39;</span>]

prod_features_df <span style="color:#f92672">=</span> (order_products_prior_df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>],as_index<span style="color:#f92672">=</span>False)
                                           <span style="color:#f92672">.</span>agg(OrderedDict(
                                                   [(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">nunique</span><span style="color:#e6db74">&#39;</span>),
                                                    (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">add_to_cart_order</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>)])))
prod_features_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">+</span> prod_features
<span style="color:#66d9ef">print</span>(prod_features_df<span style="color:#f92672">.</span>head())
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
   product_id  product_total_orders  product_avg_add_to_cart_order
<span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">1</span>                  <span style="color:#ae81ff">1852</span>                       <span style="color:#ae81ff">5.801836</span>
<span style="color:#ae81ff">1</span>           <span style="color:#ae81ff">2</span>                    <span style="color:#ae81ff">90</span>                       <span style="color:#ae81ff">9.888889</span>
<span style="color:#ae81ff">2</span>           <span style="color:#ae81ff">3</span>                   <span style="color:#ae81ff">277</span>                       <span style="color:#ae81ff">6.415162</span>
<span style="color:#ae81ff">3</span>           <span style="color:#ae81ff">4</span>                   <span style="color:#ae81ff">329</span>                       <span style="color:#ae81ff">9.507599</span>
<span style="color:#ae81ff">4</span>           <span style="color:#ae81ff">5</span>                    <span style="color:#ae81ff">15</span>                       <span style="color:#ae81ff">6.466667</span>

</code></pre></div><p>Add thêm đặc trưng sản phẩm vào trong tập huấn luyện</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(prod_features_df, on<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#75715e">#note that dropping rows with NA product_avg_days_since_prior_order is likely a naive choice </span>
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>dropna()
<span style="color:#66d9ef">print</span>(df_X<span style="color:#f92672">.</span>head())
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">   product_id  user_id              <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>               product_total_orders product_avg_add_to_cart_order
<span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">138</span>              <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>                               <span style="color:#ae81ff">1852</span>                      <span style="color:#ae81ff">5.801836</span>
<span style="color:#ae81ff">1</span>           <span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">709</span>              <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>                               <span style="color:#ae81ff">1852</span>                      <span style="color:#ae81ff">5.801836</span>
<span style="color:#ae81ff">2</span>           <span style="color:#ae81ff">1</span>      <span style="color:#ae81ff">777</span>              <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>                               <span style="color:#ae81ff">1852</span>                      <span style="color:#ae81ff">5.801836</span>
<span style="color:#ae81ff">3</span>           <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">1052</span>              <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>                               <span style="color:#ae81ff">1852</span>                      <span style="color:#ae81ff">5.801836</span>
<span style="color:#ae81ff">4</span>           <span style="color:#ae81ff">1</span>     <span style="color:#ae81ff">1494</span>              <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>                               <span style="color:#ae81ff">1852</span>                      <span style="color:#ae81ff">5.801836</span>

</code></pre></div><h2 id="đặc-trưng-người-dùng">Đặc trưng người dùng</h2>
<p>Với người dùng, chúng sa sử dụng các đặc trưng là: Tổng số lượng đơn hàng, trung bình số sản phẩm trong 1 đơn hàng, tổng số lượng sản phẩm người dùng mua, Trung bình số ngày user sẽ mua đơn hàng tiếp theo</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">user_features <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_total_orders</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_avg_cartsize</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_total_products</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_avg_days_since_prior_order</span><span style="color:#e6db74">&#39;</span>]

user_features_df <span style="color:#f92672">=</span> (order_products_prior_df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>],as_index<span style="color:#f92672">=</span>False)
                                           <span style="color:#f92672">.</span>agg(OrderedDict(
                                                   [(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_id</span><span style="color:#e6db74">&#39;</span>,[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">nunique</span><span style="color:#e6db74">&#39;</span>, (<span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">/</span> x<span style="color:#f92672">.</span>nunique())]),
                                                    (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">nunique</span><span style="color:#e6db74">&#39;</span>),
                                                    (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">days_since_prior_order</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>)])))

user_features_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">+</span> user_features
<span style="color:#66d9ef">print</span>(user_features_df<span style="color:#f92672">.</span>head())
</code></pre></div><p>Và chúng ta merge tiếp đặc trưng user vào trong tập huấn luyện.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(user_features_df, on<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#75715e">#note that dropping rows with NA product_avg_days_since_prior_order is likely a naive choice </span>
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>dropna()
</code></pre></div><h2 id="đặc-trưng-mối-tương-quan-giữa-người-dùng-và-sản-phẩm">Đặc trưng mối tương quan giữa người dùng và sản phẩm</h2>
<p>Ở đây, chúng ta sử dụng đặc trưng trung bình số sản phẩm của 1 người được thêm vào đơn hàng và tần suất 1 sản phẩm 1 user add vào đơn hàng.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">user_prod_features <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_add_to_cart_order</span><span style="color:#e6db74">&#39;</span>]

user_prod_features_df <span style="color:#f92672">=</span> (order_products_prior_df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>],as_index<span style="color:#f92672">=</span>False) \
                                                <span style="color:#f92672">.</span>agg(OrderedDict(
                                                     [(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">add_to_cart_order</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>)])))

user_prod_features_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">+</span> user_prod_features
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(user_prod_features_df,on<span style="color:#f92672">=</span>[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>])
df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_order_freq</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_total_orders</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">/</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_total_orders</span><span style="color:#e6db74">&#39;</span>] 
</code></pre></div><h1 id="bổ-sung-thêm-đặc-trưng">Bổ sung thêm đặc trưng</h1>
<p>Ngoài các đặc trưng cơ bản ở trên, ta sẽ bổ sung thêm một số đặc trưng khác:</p>
<p>Đặc trưng sản phẩm: bổ sung thêm 3 đặc trưng trung bình ngày trong tuần được đặt hàng  (cột order_down), trung bình giờ đặt hàng (cột order_hour_of_day), trung bình ngày đặt hàng kể từ lần đặt trước đó (cột days_since_prior_order) theo sản phẩm.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">prod_features <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_order_dow</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_order_hour_of_day</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_days_since_prior_order</span><span style="color:#e6db74">&#39;</span>]

prod_features_df <span style="color:#f92672">=</span> (order_products_prior_df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>], as_index<span style="color:#f92672">=</span>False)
                                     <span style="color:#f92672">.</span>agg(OrderedDict(
                                     [(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_dow</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>),
                                      (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_hour_of_day</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>),
                                      (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">days_since_prior_order</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>)])))

prod_features_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">+</span> prod_features

df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(prod_features_df, on<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>)
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>dropna()
</code></pre></div><p>Đặc trưng người dùng: bổ sung thêm 2 cột đặc trung trung bình ngày trong tuần được đặt hàng  (cột order_down) và  trung bình giờ đặt hàng (cột order_hour_of_day) theo người dùng</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">user_features <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_avg_order_dow</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_avg_order_hour_of_day</span><span style="color:#e6db74">&#39;</span>]

user_features_df <span style="color:#f92672">=</span> (order_products_prior_df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>],as_index<span style="color:#f92672">=</span>False)
                                           <span style="color:#f92672">.</span>agg(OrderedDict(
                                                   [(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_dow</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>),
                                                    (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_hour_of_day</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>)])))

user_features_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">+</span> user_features
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(user_features_df, on<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>)
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>dropna()
</code></pre></div><p>Đặc trung người dùng - sản phẩm: Bổ sung thêm đặc trưng tung bình trên cột order_down, order_hour_of_day, days_since_prior_order theo người dùng và sản phẩm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
user_prod_features <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_days_since_prior_order</span><span style="color:#e6db74">&#39;</span>,
                      <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_order_dow</span><span style="color:#e6db74">&#39;</span>,
                      <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_order_hour_of_day</span><span style="color:#e6db74">&#39;</span>]

user_prod_features_df <span style="color:#f92672">=</span> (order_products_prior_df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>],as_index<span style="color:#f92672">=</span>False) \
                                                <span style="color:#f92672">.</span>agg(OrderedDict(
                                                     [(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">days_since_prior_order</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>),
                                                     (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_dow</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>),
                                                     (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">order_hour_of_day</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mean</span><span style="color:#e6db74">&#39;</span>)])))

user_prod_features_df<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">+</span> user_prod_features 

df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(user_prod_features_df, on<span style="color:#f92672">=</span>[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>])
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>dropna()
</code></pre></div><p>Đặc trưng độ lệch: Tính độ lệch của của một số đặc trưng so với trung bình của chúng</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Create delta columns to compare how users perform against averages</span>
df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_total_orders_delta_per_user</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_total_orders</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">-</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_total_orders</span><span style="color:#e6db74">&#39;</span>]

df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_add_to_cart_order_delta_per_user</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_add_to_cart_order</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">-</span> \
                                                            df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_add_to_cart_order</span><span style="color:#e6db74">&#39;</span>]

df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_order_dow_per_user</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_order_dow</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">-</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_order_dow</span><span style="color:#e6db74">&#39;</span>]

df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_order_hour_of_day_per_user</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_order_hour_of_day</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">-</span> \
                                                            df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_order_hour_of_day</span><span style="color:#e6db74">&#39;</span>]

df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_days_since_prior_order_per_user</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">=</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_avg_days_since_prior_order</span><span style="color:#e6db74">&#39;</span>] <span style="color:#f92672">-</span> \
                                                            df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_product_avg_days_since_prior_order</span><span style="color:#e6db74">&#39;</span>]
</code></pre></div><p>Bổ sung thêm đặc trưng department name</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f_departments_df <span style="color:#f92672">=</span> products_df<span style="color:#f92672">.</span>merge(departments_df, on <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">department_id</span><span style="color:#e6db74">&#39;</span>)
f_departments_df <span style="color:#f92672">=</span> f_departments_df[[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">department</span><span style="color:#e6db74">&#39;</span>]]

df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>merge(f_departments_df, on <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>)
df_X <span style="color:#f92672">=</span> df_X<span style="color:#f92672">.</span>dropna()
df_X <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df_X, pd<span style="color:#f92672">.</span>get_dummies(df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">department</span><span style="color:#e6db74">&#39;</span>])], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">del</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">department</span><span style="color:#e6db74">&#39;</span>]
</code></pre></div><p>Chúng ta có tổng cộng 21 department name, vậy chúng ta thêm 21 cột, một cột tương ứng với một department name, ví dụ: alcohol,babies ,bakery, &hellip; Sản phẩm thuộc department name thì sẽ được đánh số 1, không thuộc department name thì đánh số 0.</p>
<h1 id="huấn-luyện-mô-hình">Huấn luyện mô hình</h1>
<p>Chia tập dữ liệu thành 80/20 trong đó 80% là tập train, 20% là tập test. Sử dụng k-fold-cross_validation với k=10</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">99</span>)
total_users <span style="color:#f92672">=</span> df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>unique() 
test_users <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>choice(total_users, size<span style="color:#f92672">=</span>int(total_users<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">20</span>), replace<span style="color:#f92672">=</span>False)



test_user_sets <span style="color:#f92672">=</span> []
length <span style="color:#f92672">=</span> len(test_users)
cv <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>


<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range (<span style="color:#ae81ff">0</span>, cv):
    start <span style="color:#f92672">=</span> int(x<span style="color:#f92672">/</span>cv<span style="color:#f92672">*</span>length)
    finish <span style="color:#f92672">=</span> int((x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">/</span>cv<span style="color:#f92672">*</span>length)
    test_user_sets<span style="color:#f92672">.</span>append(test_users[start:finish])

cv_f1_scores <span style="color:#f92672">=</span> []
cv_f1_scores_balanced <span style="color:#f92672">=</span> []
cv_f1_scores_10fit <span style="color:#f92672">=</span> []

<span style="color:#66d9ef">for</span> test_user_set <span style="color:#f92672">in</span> test_user_sets:
    df_X_tr, df_X_te <span style="color:#f92672">=</span> df_X[<span style="color:#f92672">~</span>df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>isin(test_user_set)], df_X[df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>isin(test_user_set)] 

    y_tr, y_te <span style="color:#f92672">=</span> df_X_tr[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>], df_X_te[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>]
    X_tr, X_te <span style="color:#f92672">=</span> df_X_tr<span style="color:#f92672">.</span>drop([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">latest_cart</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>), \
             df_X_te<span style="color:#f92672">.</span>drop([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">latest_cart</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>), \
        
    scaler <span style="color:#f92672">=</span> MinMaxScaler()
    X_tr <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(scaler<span style="color:#f92672">.</span>fit_transform(X_tr), columns<span style="color:#f92672">=</span>X_tr<span style="color:#f92672">.</span>columns)
    X_te <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(scaler<span style="color:#f92672">.</span>fit_transform(X_te), columns<span style="color:#f92672">=</span>X_te<span style="color:#f92672">.</span>columns)
    
    lr <span style="color:#f92672">=</span> LogisticRegression(C<span style="color:#f92672">=</span><span style="color:#ae81ff">10000000</span>) 
    lr_balanced <span style="color:#f92672">=</span> LogisticRegression(class_weight<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">balanced</span><span style="color:#e6db74">&#39;</span>, C<span style="color:#f92672">=</span><span style="color:#ae81ff">10000000</span>)
    lr_10x <span style="color:#f92672">=</span> LogisticRegression(class_weight<span style="color:#f92672">=</span>{<span style="color:#ae81ff">1</span> : <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span> : <span style="color:#ae81ff">1</span>}, C<span style="color:#f92672">=</span><span style="color:#ae81ff">10000000</span>)
    
    lr<span style="color:#f92672">.</span>fit(X_tr, y_tr)
    cv_f1_scores<span style="color:#f92672">.</span>append(f1_score(lr<span style="color:#f92672">.</span>predict(X_te), y_te))

    lr_balanced<span style="color:#f92672">.</span>fit(X_tr, y_tr)
    cv_f1_scores_balanced<span style="color:#f92672">.</span>append(f1_score(lr_balanced<span style="color:#f92672">.</span>predict(X_te), y_te))

    lr_10x<span style="color:#f92672">.</span>fit(X_tr, y_tr)
    cv_f1_scores_10fit<span style="color:#f92672">.</span>append(f1_score(lr_10x<span style="color:#f92672">.</span>predict(X_te), y_te))   

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">cv_f1_scores: </span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span>str( np<span style="color:#f92672">.</span>mean(cv_f1_scores)))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">cv_f1_scores_balanced: </span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>str(np<span style="color:#f92672">.</span>mean(cv_f1_scores_balanced)))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">cv_f1_scores_10fit: </span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>str(np<span style="color:#f92672">.</span>mean(cv_f1_scores_10fit)))

df_X_tr, df_X_te <span style="color:#f92672">=</span> df_X[<span style="color:#f92672">~</span>df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>isin(test_users)], df_X[df_X[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>isin(test_users)]

y_tr, y_te <span style="color:#f92672">=</span> df_X_tr[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>], df_X_te[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>]
X_tr, X_te <span style="color:#f92672">=</span> df_X_tr<span style="color:#f92672">.</span>drop([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">latest_cart</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>), \
             df_X_te<span style="color:#f92672">.</span>drop([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">product_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">user_id</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">latest_cart</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">in_cart</span><span style="color:#e6db74">&#39;</span>],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>), \

lr_10x <span style="color:#f92672">=</span> LogisticRegression(class_weight<span style="color:#f92672">=</span>{<span style="color:#ae81ff">1</span> : <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span> : <span style="color:#ae81ff">1</span>}, C<span style="color:#f92672">=</span><span style="color:#ae81ff">10000000</span>)
lr_10x<span style="color:#f92672">.</span>fit(X_tr, y_tr)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">F1 store all: </span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>str(f1_score(lr_10x<span style="color:#f92672">.</span>predict(X_te), y_te)))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">cv_f1_scores: <span style="color:#ae81ff">0.2026889989037295</span>
cv_f1_scores_balanced: <span style="color:#ae81ff">0.3816810646496983</span>
cv_f1_scores_10fit: <span style="color:#ae81ff">0.3899595078917494</span>

F1 store all: <span style="color:#ae81ff">0.3808374055616213</span>
</code></pre></div><p>Thử in ra hệ số của hàm hồi quy</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">coefficients <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(lr_10x<span style="color:#f92672">.</span>coef_, columns <span style="color:#f92672">=</span> X_tr<span style="color:#f92672">.</span>columns)
coefficients <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>exp(coefficients)
<span style="color:#66d9ef">print</span>(coefficients<span style="color:#f92672">.</span>T)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">user_product_total_orders                     <span style="color:#ae81ff">1.160475</span>
product_total_orders                          <span style="color:#ae81ff">1.077254</span>
product_avg_add_to_cart_order                 <span style="color:#ae81ff">0.915343</span>
user_total_orders                             <span style="color:#ae81ff">0.983272</span>
user_avg_cartsize                             <span style="color:#ae81ff">1.059655</span>
user_total_products                           <span style="color:#ae81ff">0.993839</span>
user_avg_days_since_prior_order               <span style="color:#ae81ff">0.993513</span>
user_product_avg_add_to_cart_order            <span style="color:#ae81ff">0.950418</span>
user_product_order_freq                       <span style="color:#ae81ff">1.051246</span>
product_avg_order_dow                         <span style="color:#ae81ff">0.994744</span>
product_avg_order_hour_of_day                 <span style="color:#ae81ff">1.010971</span>
product_avg_days_since_prior_order            <span style="color:#ae81ff">0.994498</span>
user_avg_order_dow                            <span style="color:#ae81ff">0.997298</span>
user_avg_order_hour_of_day                    <span style="color:#ae81ff">1.012958</span>
user_product_avg_days_since_prior_order       <span style="color:#ae81ff">1.003382</span>
user_product_avg_order_dow                    <span style="color:#ae81ff">0.994477</span>
user_product_avg_order_hour_of_day            <span style="color:#ae81ff">1.003457</span>
product_total_orders_delta_per_user           <span style="color:#ae81ff">0.928288</span>
product_avg_add_to_cart_order_delta_per_user  <span style="color:#ae81ff">0.963095</span>
product_avg_order_dow_per_user                <span style="color:#ae81ff">1.000268</span>
product_avg_order_hour_of_day_per_user        <span style="color:#ae81ff">1.007489</span>
product_avg_days_since_prior_order_per_user   <span style="color:#ae81ff">0.991147</span>
alcohol                                       <span style="color:#ae81ff">0.998866</span>
babies                                        <span style="color:#ae81ff">1.000313</span>
bakery                                        <span style="color:#ae81ff">1.003098</span>
beverages                                     <span style="color:#ae81ff">1.007733</span>
breakfast                                     <span style="color:#ae81ff">1.000117</span>
bulk                                          <span style="color:#ae81ff">0.999980</span>
canned goods                                  <span style="color:#ae81ff">0.995017</span>
dairy eggs                                    <span style="color:#ae81ff">1.018069</span>
deli                                          <span style="color:#ae81ff">1.002720</span>
dry goods pasta                               <span style="color:#ae81ff">0.997379</span>
frozen                                        <span style="color:#ae81ff">1.000752</span>
household                                     <span style="color:#ae81ff">0.992164</span>
international                                 <span style="color:#ae81ff">0.996822</span>
meat seafood                                  <span style="color:#ae81ff">1.000340</span>
missing                                       <span style="color:#ae81ff">1.001953</span>
other                                         <span style="color:#ae81ff">0.999607</span>
pantry                                        <span style="color:#ae81ff">0.972038</span>
personal care                                 <span style="color:#ae81ff">0.992072</span>
pets                                          <span style="color:#ae81ff">1.000466</span>
produce                                       <span style="color:#ae81ff">1.017809</span>
snacks                                        <span style="color:#ae81ff">1.004893</span>
</code></pre></div><p>Thử show confusion matrix của dữ liệu:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> confusion_matrix
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">%</span>matplotlib inline
plt<span style="color:#f92672">.</span>style<span style="color:#f92672">.</span>use(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">fivethirtyeight</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_confusion_matrix</span>(cm,title<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Confusion matrix</span><span style="color:#e6db74">&#39;</span>, cmap<span style="color:#f92672">=</span>plt<span style="color:#f92672">.</span>cm<span style="color:#f92672">.</span>Reds):
    plt<span style="color:#f92672">.</span>imshow(cm, interpolation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">nearest</span><span style="color:#e6db74">&#39;</span>,cmap<span style="color:#f92672">=</span>cmap)
    plt<span style="color:#f92672">.</span>title(title)
    plt<span style="color:#f92672">.</span>colorbar()
    plt<span style="color:#f92672">.</span>tight_layout()
    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">True label</span><span style="color:#e6db74">&#39;</span>)
    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Predicted label</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#75715e">#y_tr=np.ravel(y_tr)</span>

train_acc<span style="color:#f92672">=</span>lr_10x<span style="color:#f92672">.</span>score(X_tr, y_tr)
test_acc<span style="color:#f92672">=</span>lr_10x<span style="color:#f92672">.</span>score(X_te, y_te)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Training Data Accuracy: </span><span style="color:#e6db74">%0.2f</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span>(train_acc))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Test Data Accuracy:     </span><span style="color:#e6db74">%0.2f</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span>(test_acc))
    
y_true <span style="color:#f92672">=</span> y_te
y_pred <span style="color:#f92672">=</span> lr_10x<span style="color:#f92672">.</span>predict(X_te)


conf <span style="color:#f92672">=</span> confusion_matrix(y_true, y_pred)
<span style="color:#66d9ef">print</span>(conf)

<span style="color:#66d9ef">print</span> (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
<span style="color:#66d9ef">print</span> (<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Precision:              </span><span style="color:#e6db74">%0.2f</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span>(conf[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">/</span> (conf[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> conf[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>])))
<span style="color:#66d9ef">print</span> (<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Recall:                 </span><span style="color:#e6db74">%0.2f</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">%</span> (conf[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">/</span> (conf[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> conf[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>])))
    
cm<span style="color:#f92672">=</span>confusion_matrix(y_true, y_pred, labels<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>])
    
plt<span style="color:#f92672">.</span>figure()
plot_confusion_matrix(cm)
</code></pre></div><p>Kết quả</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Training Data Accuracy: <span style="color:#ae81ff">0.83</span>
Test Data Accuracy:     <span style="color:#ae81ff">0.83</span>
[[<span style="color:#ae81ff">1236979</span>  <span style="color:#ae81ff">190126</span>]
 [  <span style="color:#ae81ff">78107</span>   <span style="color:#ae81ff">82493</span>]]


Precision:              <span style="color:#ae81ff">0.30</span>
Recall:                 <span style="color:#ae81ff">0.51</span>
</code></pre></div><p><img src="/post_image/instartcart_plot_confusion_matrix.png" alt="Hình ảnh"></p>
<p>Show đường cong ROC của dữ liệu</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> roc_curve, auc

y_score <span style="color:#f92672">=</span> lr_10x<span style="color:#f92672">.</span>predict_proba(X_te)[:,<span style="color:#ae81ff">1</span>]

fpr, tpr,_ <span style="color:#f92672">=</span> roc_curve(y_te, y_score)
roc_auc <span style="color:#f92672">=</span> auc(fpr, tpr)

plt<span style="color:#f92672">.</span>figure()
<span style="color:#75715e"># Plotting our Baseline..</span>
plt<span style="color:#f92672">.</span>plot([<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>],[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>], linestyle<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">--</span><span style="color:#e6db74">&#39;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">black</span><span style="color:#e6db74">&#39;</span>)
plt<span style="color:#f92672">.</span>plot(fpr, tpr, color <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">green</span><span style="color:#e6db74">&#39;</span>)
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">False Positive Rate</span><span style="color:#e6db74">&#39;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">True Positive Rate</span><span style="color:#e6db74">&#39;</span>)
plt<span style="color:#f92672">.</span>gca()<span style="color:#f92672">.</span>set_aspect(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">equal</span><span style="color:#e6db74">&#39;</span>, adjustable<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">box</span><span style="color:#e6db74">&#39;</span>)
</code></pre></div><p><img src="/post_image/instartcart_roc.png" alt="Hình ảnh"></p>
<p>Cảm ơn các bạn đã theo dõi. Hẹn gặp bạn ở các bài viết tiếp theo.</p>

  </div>
  
			</div>
  <footer class="col-md-10  mx-auto">
  <div >
  <div class="fb-like" data-share="true"  data-width="450"  data-show-faces="true">
</div> </p></div>
    <ul class="stats list-unstyled">
 
    
  <li class="tags">
    <ul class="list-inline">
       
            
            
                <i class="fa fa-tags"></i>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/machine-learning">Machine learning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/deeplearning">Deeplearning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/instacart">instacart</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/gi%E1%BB%8F-h%C3%A0ng">Giỏ hàng</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/%C4%91%C6%A1n-h%C3%A0ng">Đơn hàng</a></li>
                
            
        
    </ul>
  </li>
  
</ul>

	</div>
  </footer>
  <hr/>
<div class="titlerelate">Bài viết khác</div>
<div class="infinite-container featured-task">
<div class="card-deck card-break infinite-item">



    
        <div class="card">
		<a href="/blog/2018-11-10-stock-prediction_v1/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="../../post_image/sp500_header.png" width="100" />
		<div class="card-body">
		<h5 class="card-title">
		Dự đoán giá chứng khoán SP500 sử dụng LSTM
				</h5>
				</div>
				</a>
				</div>
    

    
        <div class="card">
		<a href="/blog/2018-12-05-what-do-we-learn-from-object-detection-p1/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/post_image/sliding-window.gif" width="100" />
		
		<div class="card-body">
		<h5 class="card-title">
		Tìm hiểu region based object detectors
				</h5>
				</div>
				</a>
				</div>
    

</div>
</div>



<div class="fb-comments" data-href="" data-width="" data-numposts="5"></div>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "phamduytung" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>



</article>


		
    </main>
    
	</div>
	</div>
    
	<hr>
  <footer class="footer">
  <div class="container text-center">
    
    <p class="copyright">
      
        &copy; 2020
        
          Phạm Duy Tùng Machine Learning Blog
        
      
     
    </p>
	</div>
  </footer>
    
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/languages/python.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
     

   <script src="/js/jquery-3.3.1.min.js"></script>
   
    <script src="/js/bootstrap.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
     
    

    
      
        
      
    
	
    
    <script>hljs.initHighlightingOnLoad();</script>
      
<script async
src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


	  
	  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114911596-1"  data-cfasync="false"></script>
<script  data-cfasync="false">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114911596-1');
</script>
<script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.5.1/intersection-observer.js"  data-cfasync="false"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.0.0/dist/lazyload.min.js"  data-cfasync="false"></script>
	   <script  type="text/javascript"  data-cfasync="false">

  function getcontent(){
 

   

             var myLazyLoad = new LazyLoad({
    elements_selector: ".lazy"
});
                }
            
			
			$(document).ready(function(){
			getcontent();
			}); 
</script>

  </body>
</html>

