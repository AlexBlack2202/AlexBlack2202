<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "\/"
        },
        "articleSection" : "blog",
        "name" : "Dự đoán chứng khoán sử dụng tensorflow",
        "headline" : "Dự đoán chứng khoán sử dụng tensorflow",
        "description" : "Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng tensorflow để dự đoán chỉ số S\x26P 500.",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-11-03 00:19:00 \x2b0300 \x2b0300",
        "dateModified" : "2018-11-03 00:19:00 \x2b0300 \x2b0300",
        "url" : "\/blog\/2018-11-03-stock-prediction\/",
        "wordCount" : "1037",
        "keywords" : [ "Machine learning","Deep learning","stock prediction","Blog" ]
    }
    </script>
        
            
                <title>Dự đoán chứng khoán sử dụng tensorflow</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
		<meta name="generator" content="Phạm Duy Tùng" />
        
  
    
  

  

  
  
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta name="msapplication-tooltip" content="Blog ML của Phạm Duy Tùng và Đặng Thị Hằng">
   
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">



        
            <meta name="author" content="Phạm Duy Tùng">
        
        
            <meta name="description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng tensorflow để dự đoán chỉ số S&amp;P 500.">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dự đoán chứng khoán sử dụng tensorflow"/>
<meta name="twitter:description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng tensorflow để dự đoán chỉ số S&amp;P 500."/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Dự đoán chứng khoán sử dụng tensorflow" />
<meta property="og:description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng tensorflow để dự đoán chỉ số S&amp;P 500." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2018-11-03-stock-prediction/" />
<meta property="article:published_time" content="2018-11-03T00:19:00+03:00" />
<meta property="article:modified_time" content="2018-11-03T00:19:00+03:00" />

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Dự đoán chứng khoán sử dụng tensorflow">
<meta itemprop="description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng tensorflow để dự đoán chỉ số S&amp;P 500.">
<meta itemprop="datePublished" content="2018-11-03T00:19:00&#43;03:00" />
<meta itemprop="dateModified" content="2018-11-03T00:19:00&#43;03:00" />
<meta itemprop="wordCount" content="1037">



<meta itemprop="keywords" content="Machine learning,Deep learning,stock prediction," />
        

        
            
        

        
        
          
			
			 <link rel="stylesheet" href="/css/font-awesome.min.css">
			 <link rel="stylesheet" href="/css/bootstrap.min.css">


          
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.15.8/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-114911596-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

	  
	  <style>
	  
	  body{
font-family: Helvetica,Arial,sans-serif;
}

.card{
	margin-bottom: 10px;
}

#disqus_thread{
padding: 0 5px;
}

.item-header{
padding: 0;
}

.single-content-img{
width: 100%;
    max-height: 450px !important;
    background-size: cover;
    display: block;
    background-position: center;
}

.thumbnail {
    position: relative;
}

.caption {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
	background: rgba(0, 0, 0, 0.25);
	text-align:left;
}

.caption .title{
	font-size: 1.6em;
    line-height: 1.4em;
    top: 0;
	margin-left:20px;
	margin-top:20px;
	
}

.caption .title-caption{
margin-left:10px;
}

#content p{
text-align: justify;
    line-height: 1.9;
    font-size: 12pt;
}

#content img{
	display: block;
    margin-left: auto;
margin-right: auto;
max-width:98%;
}

img + strong {
    font-style: normal;
    display: inherit;
    text-align: center;
}
.img-news{
max-height:150px;
width:100%;
}

.news-tittle{
	padding-top:15px;
	text-align:justify;
}

.author{
	color: orange;
}
.author-inline{
	color: orange;
}

.adv{
height:18px;
}

h1, h2, h3, h4{
padding-bottom: 10px;
    font-weight: bold;
}

h1{
color: #d04764}


h2{
color: orange}

h3{
color: #d04764}

h4{
color: #8dec89}

.hljs{
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;}
	  .titledetail {
    display: block;
    overflow: hidden;
    line-height: 53px;
    font-size: 45px;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;
    margin: auto;
	padding:25px 0;
	text-align:justify;
}

.newsrelate {
    display: block;
    overflow: hidden;
	 list-style:none;
}
a ,a:hover{
    text-decoration: none;
}
.newsrelate li {
    float: left;
    overflow: hidden;
    width: 30%;
    margin-left: 2.5%;
    margin-bottom: 15px;
}

.newsrelate li a {
    display: block;
    overflow: hidden;
}

.newsrelate li h3 {
    display: block;
    overflow: hidden;
    line-height: 1.3em;
    font-size: 16pt;
    color: #333;
    line-height: 22px;
    font-weight: 300;
    font-family: Arial,Helvetica,sans-serif;
    width: auto;
    margin: 5px auto;
}

.titlerelate {
    overflow: hidden;
    font-size: 18px;
    font-weight: 600;
    color: #333;
    font-family: 'Roboto Condensed',sans-serif;
    line-height: 32px;
    text-transform: uppercase;
}


	  </style>
	  
    </head>
    <body>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1546237302193677',
      xfbml      : true,
      version    : 'v5.0'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v5.0&appId=1853483258232756&autoLogAppEvents=1"></script>
      
      

    
    
<header id="header"  style="background: #790014; color: hsla(0,0%,100%,1);">
<div class="container">
    <nav class="navbar navbar-expand-md navbar-dark">
	
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            
                <li class="nav-item">
                    <a class='nav-link' href="/blog">
                            <i class="fa fa-home active">&nbsp;</i>Home
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/news/">
                            <i class="fa fa-list">&nbsp;</i>News
                    </a>
                </li>
            
                <li class="nav-item">
                    <a class='nav-link' href="/xem-truyen/">
                            <i class="fa fa-id-card-o">&nbsp;</i>Truyện
                    </a>
                </li>
            
        </ul>
    </nav>
    </div></div>
</header>


   
    
	<div class="container">
	<div class="adv"></div>
	<div>
    <main role="main" >
	
        
        
        <article class="col-md-10 col-lg-9 mx-auto">
  


        
		 <div class="">
            <h3 class="titledetail">Dự đoán chứng khoán sử dụng tensorflow</h3>
			
			<div class="col-md-12">
			 
			  <time class="published"
            datetime='2018-11-03'>
            03/11/2018</time>
		 - 
			   <span class="author">Phạm Duy Tùng</span>
			   
			
		<div class="thumbnail text-center">
		 <img class="img-fluid single-content-img lazy" src="../../post_image/stock_finance_chart.png" />
		
			</div>
			 
            
        
       



  

  

  <div id="content" class="col-md-10 mx-auto">
    <h2 id="lời-mở-đầu">Lời mở đầu</h2>
<p>Ở bài viết này, mình sẽ xây dựng mô hình hơn giản để áp dụng vào tập dữ liệu giá chứng khoán. Mục tiêu của bài này là chúng ta sẽ dự đoán chỉ số S&amp;P 500 dựa trên chỉ số của 500 mã chứng khoán. Các bạn có nhu cầu tìm hiểu thêm về chỉ số sp 500 có thể đọc thêm ở <a href="https://vi.wikipedia.org/wiki/S%26P_500">https://vi.wikipedia.org/wiki/S%26P_500</a>. Đây là một ứng dụng nhỏ, không có ý nghĩa nhiều ở thực tế do khi phân tích chứng khoán, ta còn xét thêm rất nhiều yếu tố phụ nữa. Mô hình này thực chất chỉ là một trong những mô hình chơi chơi.</p>
<h2 id="dẫn-nhập">Dẫn nhập</h2>
<h3 id="phân-tích-dữ-liệu">Phân tích dữ liệu</h3>
<p>Các bạn có thể download dữ liệu ở <a href="https://drive.google.com/open?id=1UTlj5Ced-yj6RBRVc6bBM6IWMjfQR3GR">https://drive.google.com/open?id=1UTlj5Ced-yj6RBRVc6bBM6IWMjfQR3GR</a>.</p>
<p>Đầu tiên, chúng ta sẽ dùng pandas để load mô hình lên:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

<span style="color:#75715e"># Import data</span>
data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">data_stocks.csv</span><span style="color:#e6db74">&#39;</span>)


</code></pre></div><p>Xem kích thước của dữ liệu:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(data<span style="color:#f92672">.</span>shape)

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">(<span style="color:#ae81ff">41266</span>, <span style="color:#ae81ff">502</span>)
</code></pre></div><p>Kết quả là ta có hơn 40 ngàn dòng và 502 cột. Thử show 10 row đầu tiên của dữ liệu lên xem như thế nào.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(data<span style="color:#f92672">.</span>head())
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">         DATE      SP500  NASDAQ<span style="color:#f92672">.</span>AAL  NASDAQ<span style="color:#f92672">.</span>AAPL  NASDAQ<span style="color:#f92672">.</span>ADBE  NASDAQ<span style="color:#f92672">.</span>ADI  \
<span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">1491226200</span>  <span style="color:#ae81ff">2363.6101</span>     <span style="color:#ae81ff">42.3300</span>     <span style="color:#ae81ff">143.6800</span>     <span style="color:#ae81ff">129.6300</span>      <span style="color:#ae81ff">82.040</span>   
<span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">1491226260</span>  <span style="color:#ae81ff">2364.1001</span>     <span style="color:#ae81ff">42.3600</span>     <span style="color:#ae81ff">143.7000</span>     <span style="color:#ae81ff">130.3200</span>      <span style="color:#ae81ff">82.080</span>   
<span style="color:#ae81ff">2</span>  <span style="color:#ae81ff">1491226320</span>  <span style="color:#ae81ff">2362.6799</span>     <span style="color:#ae81ff">42.3100</span>     <span style="color:#ae81ff">143.6901</span>     <span style="color:#ae81ff">130.2250</span>      <span style="color:#ae81ff">82.030</span>   
<span style="color:#ae81ff">3</span>  <span style="color:#ae81ff">1491226380</span>  <span style="color:#ae81ff">2364.3101</span>     <span style="color:#ae81ff">42.3700</span>     <span style="color:#ae81ff">143.6400</span>     <span style="color:#ae81ff">130.0729</span>      <span style="color:#ae81ff">82.000</span>   
<span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">1491226440</span>  <span style="color:#ae81ff">2364.8501</span>     <span style="color:#ae81ff">42.5378</span>     <span style="color:#ae81ff">143.6600</span>     <span style="color:#ae81ff">129.8800</span>      <span style="color:#ae81ff">82.035</span>   

   NASDAQ<span style="color:#f92672">.</span>ADP  NASDAQ<span style="color:#f92672">.</span>ADSK  NASDAQ<span style="color:#f92672">.</span>AKAM  NASDAQ<span style="color:#f92672">.</span>ALXN    <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>     NYSE<span style="color:#f92672">.</span>WYN  \
<span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">102.2300</span>      <span style="color:#ae81ff">85.2200</span>       <span style="color:#ae81ff">59.760</span>       <span style="color:#ae81ff">121.52</span>    <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>       <span style="color:#ae81ff">84.370</span>   
<span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">102.1400</span>      <span style="color:#ae81ff">85.6500</span>       <span style="color:#ae81ff">59.840</span>       <span style="color:#ae81ff">121.48</span>    <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>       <span style="color:#ae81ff">84.370</span>   
<span style="color:#ae81ff">2</span>    <span style="color:#ae81ff">102.2125</span>      <span style="color:#ae81ff">85.5100</span>       <span style="color:#ae81ff">59.795</span>       <span style="color:#ae81ff">121.93</span>    <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>       <span style="color:#ae81ff">84.585</span>   
<span style="color:#ae81ff">3</span>    <span style="color:#ae81ff">102.1400</span>      <span style="color:#ae81ff">85.4872</span>       <span style="color:#ae81ff">59.620</span>       <span style="color:#ae81ff">121.44</span>    <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>       <span style="color:#ae81ff">84.460</span>   
<span style="color:#ae81ff">4</span>    <span style="color:#ae81ff">102.0600</span>      <span style="color:#ae81ff">85.7001</span>       <span style="color:#ae81ff">59.620</span>       <span style="color:#ae81ff">121.60</span>    <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>       <span style="color:#ae81ff">84.470</span>   

   NYSE<span style="color:#f92672">.</span>XEC  NYSE<span style="color:#f92672">.</span>XEL  NYSE<span style="color:#f92672">.</span>XL  NYSE<span style="color:#f92672">.</span>XOM  NYSE<span style="color:#f92672">.</span>XRX  NYSE<span style="color:#f92672">.</span>XYL  NYSE<span style="color:#f92672">.</span>YUM  \
<span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">119.035</span>     <span style="color:#ae81ff">44.40</span>    <span style="color:#ae81ff">39.88</span>     <span style="color:#ae81ff">82.03</span>      <span style="color:#ae81ff">7.36</span>     <span style="color:#ae81ff">50.22</span>     <span style="color:#ae81ff">63.86</span>   
<span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">119.035</span>     <span style="color:#ae81ff">44.11</span>    <span style="color:#ae81ff">39.88</span>     <span style="color:#ae81ff">82.03</span>      <span style="color:#ae81ff">7.38</span>     <span style="color:#ae81ff">50.22</span>     <span style="color:#ae81ff">63.74</span>   
<span style="color:#ae81ff">2</span>   <span style="color:#ae81ff">119.260</span>     <span style="color:#ae81ff">44.09</span>    <span style="color:#ae81ff">39.98</span>     <span style="color:#ae81ff">82.02</span>      <span style="color:#ae81ff">7.36</span>     <span style="color:#ae81ff">50.12</span>     <span style="color:#ae81ff">63.75</span>   
<span style="color:#ae81ff">3</span>   <span style="color:#ae81ff">119.260</span>     <span style="color:#ae81ff">44.25</span>    <span style="color:#ae81ff">39.99</span>     <span style="color:#ae81ff">82.02</span>      <span style="color:#ae81ff">7.35</span>     <span style="color:#ae81ff">50.16</span>     <span style="color:#ae81ff">63.88</span>   
<span style="color:#ae81ff">4</span>   <span style="color:#ae81ff">119.610</span>     <span style="color:#ae81ff">44.11</span>    <span style="color:#ae81ff">39.96</span>     <span style="color:#ae81ff">82.03</span>      <span style="color:#ae81ff">7.36</span>     <span style="color:#ae81ff">50.20</span>     <span style="color:#ae81ff">63.91</span>   

   NYSE<span style="color:#f92672">.</span>ZBH  NYSE<span style="color:#f92672">.</span>ZTS  
<span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">122.000</span>    <span style="color:#ae81ff">53.350</span>  
<span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">121.770</span>    <span style="color:#ae81ff">53.350</span>  
<span style="color:#ae81ff">2</span>   <span style="color:#ae81ff">121.700</span>    <span style="color:#ae81ff">53.365</span>  
<span style="color:#ae81ff">3</span>   <span style="color:#ae81ff">121.700</span>    <span style="color:#ae81ff">53.380</span>  
<span style="color:#ae81ff">4</span>   <span style="color:#ae81ff">121.695</span>    <span style="color:#ae81ff">53.240</span>  

</code></pre></div><p>Cột đầu tiên là ngày, sau đó là mã chứng khoán. Chúng ta có tổng cộng 500 mã chứng khoán và 1 chỉ số. Để ý cột Date, ta thấy giá trị đầu tiên là 1491226200, giá trị thứ 2 là 1491226260, giá trị thứ 3 là 1491226320, mỗi giá trị cách nhau 60. Chuyển đổi số 1491226200 sang dạng datetime thì ra giá trị  Monday, April 3, 2017 1:30:00 PM giờ GMT, tương tự số 1491226260 ra Monday, April 3, 2017 1:31:00 PM giờ GMT. Ta có thể suy luận ra là giá trị giao dịch lưu theo từng phút một (khoảng interval là 60 giây), và dữ liệu chúng ta có bắt đầu vào 3 tháng 4 năm 2017.</p>
<p>Plot đồ thị của mã SP500 lên:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt

plt<span style="color:#f92672">.</span>plot(data[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">SP500</span><span style="color:#e6db74">&#39;</span>])
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/post_image/sp500index.png" alt="Hình ảnh đừng đồ thị của chỉ số sp 500"></p>
<pre><code>Notes: Ở đây có một lưu ý nhỏ nhưng rất quan trọng. Đó là tại thời điểm phút thứ t lưu trữ giá trị sp500 của thời điểm phút thứ t+1. Ví dụ với chỉ số sp500, dòng đầu tiên ta thấy là 1491226200  2363.6101, nghĩa là giá thực tế của thời điểm 1491226260 là 2363.6101. Do bài toán của chúng ta là dữ đoán giá tương lại, nên tại thời điểm hiện tại ta sẽ dự đoán giá 1 phút sau sẽ bằng bao nhiêu. Và tập dữ liệu đã tự động dịch chuyển giá trị lên 1 phút cho chúng ta đỡ mất công làm. Còn giá của 500 cỗ phiếu còn lại vẫn là giá tại thời điểm t
</code></pre><h3 id="phân-chia-tập-train-và-test">Phân chia tập train và test.</h3>
<p>Chúng ta sẽ chia dữ liệu thành 2 phần với 80% là train và 20% còn lại là test. Do tích chất của dữ liệu là time serial nên chúng ta không thể làm thay đổi thứ tự dữ liệu.</p>
<p>Chúng ta sẽ bỏ đi cột DATE đầu tiên, và sau đó chuyển dữ liệu về dạng numpy array để dễ dàng thực hiện các phép chuyển đổi.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data_ <span style="color:#f92672">=</span> data_raw<span style="color:#f92672">.</span>drop([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">DATE</span><span style="color:#e6db74">&#39;</span>], <span style="color:#ae81ff">1</span>)

data <span style="color:#f92672">=</span> data_<span style="color:#f92672">.</span>values
<span style="color:#75715e"># Training and test data</span>
train_start <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
train_end <span style="color:#f92672">=</span> int(np<span style="color:#f92672">.</span>floor(<span style="color:#ae81ff">0.8</span><span style="color:#f92672">*</span>n))
test_start <span style="color:#f92672">=</span> train_end
test_end <span style="color:#f92672">=</span> n
data_train <span style="color:#f92672">=</span> data[ :train_end]
data_test <span style="color:#f92672">=</span> data[train_end:]

</code></pre></div><h3 id="scale-dữ-liệu">Scale dữ liệu</h3>
<p>Khi sử dụng ANN, chúng ta thông thường sẽ scale dữ liệu input về đoạn [-1,1]. Trong python, thư viện sklearn đã hỗ trợ cho chúng ta sẵn các hàm scale dữ liệu cần thiết.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Scale data</span>
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> MinMaxScaler
scaler <span style="color:#f92672">=</span> MinMaxScaler()
data_train <span style="color:#f92672">=</span> scaler<span style="color:#f92672">.</span>fit_transform(data_train)
data_test <span style="color:#f92672">=</span> scaler<span style="color:#f92672">.</span>transform(data_test)
<span style="color:#75715e"># Build X and y</span>
X_train <span style="color:#f92672">=</span> data_train[:, <span style="color:#ae81ff">1</span>:]
y_train <span style="color:#f92672">=</span> data_train[:, <span style="color:#ae81ff">0</span>]
X_test <span style="color:#f92672">=</span> data_test[:, <span style="color:#ae81ff">1</span>:]
y_test <span style="color:#f92672">=</span> data_test[:, <span style="color:#ae81ff">0</span>]

</code></pre></div><p>Mình cần dự đoán giá trị của chỉ số sp 500, nên giá trị của sp500 sẽ là cái mình cần dự đoán, chính là cột đầu tiên, còn 500 cái còn lại là input của mình.</p>
<h3 id="xây-dựng-mô-hình-sử-dụng-keras">Xây dựng mô hình sử dụng keras</h3>
<p>Ở đây mình sử dụng keras xây dựng mô hình ANN. Mô hình của mình xây dựng gồm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> keras.models <span style="color:#f92672">import</span> Sequential
<span style="color:#f92672">from</span> keras.layers.core <span style="color:#f92672">import</span> Dense, Dropout, Activation
<span style="color:#f92672">from</span> keras.callbacks <span style="color:#f92672">import</span> ModelCheckpoint
<span style="color:#f92672">from</span> keras.optimizers <span style="color:#f92672">import</span> SGD

<span style="color:#f92672">import</span> os
os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">CUDA_DEVICE_ORDER</span><span style="color:#e6db74">&#34;</span>]<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">PCI_BUS_ID</span><span style="color:#e6db74">&#34;</span>
<span style="color:#75715e"># The GPU id to use, usually either &#34;0&#34; or &#34;1&#34;</span>
os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">CUDA_VISIBLE_DEVICES</span><span style="color:#e6db74">&#34;</span>]<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">0</span><span style="color:#e6db74">&#34;</span> 
<span style="color:#75715e"># create model</span>
model <span style="color:#f92672">=</span> Sequential()
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">2048</span>, input_dim<span style="color:#f92672">=</span>input_dim,kernel_initializer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">normal</span><span style="color:#e6db74">&#39;</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">relu</span><span style="color:#e6db74">&#39;</span>))
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">1024</span>,kernel_initializer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">normal</span><span style="color:#e6db74">&#39;</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">relu</span><span style="color:#e6db74">&#39;</span>))
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">512</span>,kernel_initializer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">normal</span><span style="color:#e6db74">&#39;</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">relu</span><span style="color:#e6db74">&#39;</span>))
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">256</span>,kernel_initializer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">normal</span><span style="color:#e6db74">&#39;</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">relu</span><span style="color:#e6db74">&#39;</span>))
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">128</span>,kernel_initializer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">normal</span><span style="color:#e6db74">&#39;</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">relu</span><span style="color:#e6db74">&#39;</span>))
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">1</span>,kernel_initializer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">normal</span><span style="color:#e6db74">&#39;</span>))



model<span style="color:#f92672">.</span>compile(loss<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">mse</span><span style="color:#e6db74">&#39;</span>, optimizer<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">rmsprop</span><span style="color:#e6db74">&#39;</span>)
checkpoint <span style="color:#f92672">=</span> ModelCheckpoint(filepath<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">my_model3.h5</span><span style="color:#e6db74">&#39;</span>, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, save_best_only<span style="color:#f92672">=</span>True)
model<span style="color:#f92672">.</span>fit(X_train, y_train, epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, callbacks<span style="color:#f92672">=</span>[checkpoint], validation_split<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>)
</code></pre></div><p>Sau một thời gian chạy, mình cũng thu được model. Các bạn quan tâm có thể download model của mình huấn luyện được tại <a href="https://drive.google.com/open?id=1BLQZbcADfnLqzIHlkgpsqZBlhljBp1Eb">https://drive.google.com/open?id=1BLQZbcADfnLqzIHlkgpsqZBlhljBp1Eb</a> . Tiến hành plot dữ liệu tập test lên xem kết quả như thế nào.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
yhat <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)


x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(len(yhat))

plt<span style="color:#f92672">.</span>plot(x, y_test)
plt<span style="color:#f92672">.</span>plot(x, yhat)
plt<span style="color:#f92672">.</span>legend([<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">real</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">test</span><span style="color:#e6db74">&#39;</span>], loc<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">upper right</span><span style="color:#e6db74">&#39;</span>)
plt<span style="color:#f92672">.</span>show()


<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> mean_squared_error

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">mse: </span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span> str(mean_squared_error(y_test, yhat)))
</code></pre></div><p><img src="/post_image/chung_khoan_1.png" alt="hình chứng khoán"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mse: <span style="color:#ae81ff">0.0014582120695331884</span>
</code></pre></div><p>Kết quả của mô hình tạm chấp nhận được, về hình dạng thì khá tương đồng với kết quả. Chúng ta có thể cải tiến model bằng cách nâng số lượng layter/ hidden node, hoặc thêm dropout. Hoặc có thể thay thế mô hình bằng RNN. Chúng ta sẽ đề cập đến mô hình RNN trong bài viết sau.</p>
<p>Cảm ơn các bạn đã theo dõi. Hẹn gặp bạn ở các bài viết tiếp theo.</p>

  </div>
  
			</div>
  <footer class="col-md-10  mx-auto">
  <div >
  <div class="fb-like" data-share="true"  data-width="450"  data-show-faces="true">
</div> </p></div>
    <ul class="stats list-unstyled">
 
    
  <li class="tags">
    <ul class="list-inline">
       
            
            
                <i class="fa fa-tags"></i>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/machine-learning">Machine learning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/deep-learning">Deep learning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/stock-prediction">stock prediction</a></li>
                
            
        
    </ul>
  </li>
  
</ul>

	</div>
  </footer>
  <hr/>
<div class="titlerelate">Bài viết khác</div>
<div class="infinite-container featured-task">
<div class="card-deck card-break infinite-item">



    
        <div class="card">
		<a href="/blog/2018-11-01-overview-of-gradient-descent-optimization-algorithm/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="../../post_image/GradientDescentWithMutlipleLocalMinimum.jpg" width="100" />
		<div class="card-body">
		<h5 class="card-title">
		Overview of gradient descent optimization algorithm
				</h5>
				</div>
				</a>
				</div>
    

    
        <div class="card">
		<a href="/blog/2018-11-10-stock-prediction_v1/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="../../post_image/sp500_header.png" width="100" />
		
		<div class="card-body">
		<h5 class="card-title">
		Dự đoán giá chứng khoán SP500 sử dụng LSTM
				</h5>
				</div>
				</a>
				</div>
    

</div>
</div>



<div class="fb-comments" data-href="" data-width="" data-numposts="5"></div>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "phamduytung" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>



</article>


		
    </main>
    
	</div>
	</div>
    
	<hr>
  <footer class="footer">
  <div class="container text-center">
    
    <p class="copyright">
      
        &copy; 2020
        
          Phạm Duy Tùng Machine Learning Blog
        
      
     
    </p>
	</div>
  </footer>
    
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.15.8/languages/python.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
     

   <script src="/js/jquery-3.3.1.min.js"></script>
   
    <script src="/js/bootstrap.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
     
    

    
      
        
      
    
	
    
    <script>hljs.initHighlightingOnLoad();</script>
      
<script async
src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


	  
	  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114911596-1"  data-cfasync="false"></script>
<script  data-cfasync="false">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114911596-1');
</script>
<script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.5.1/intersection-observer.js"  data-cfasync="false"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.0.0/dist/lazyload.min.js"  data-cfasync="false"></script>
	   <script  type="text/javascript"  data-cfasync="false">

  function getcontent(){
 

   

             var myLazyLoad = new LazyLoad({
    elements_selector: ".lazy"
});
                }
            
			
			$(document).ready(function(){
			getcontent();
			}); 
</script>

  </body>
</html>

